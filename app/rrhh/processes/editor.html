<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de Proceso - RRHH IA - Velvz</title>

    <!-- Favicons -->
    <link rel="icon" href="/favicon.ico" sizes="48x48">
    <link rel="icon" href="/logoR.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/logoR.png">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/app-dashboard.css">
    <link rel="stylesheet" href="/assets/css/chatbot-config.css">
    <link rel="stylesheet" href="/assets/css/rrhh-process-editor.css">

    <!-- Auth System -->
    <script src="/assets/js/auth-config.js"></script>
    <!-- Sistema de notificaciones global -->
    <script src="/assets/js/notifications.js"></script>

    <style>
        :root {
            --rrhh-primary: #10b981;
            --rrhh-primary-light: rgba(16, 185, 129, 0.1);
            --rrhh-primary-glow: rgba(16, 185, 129, 0.3);
            --rrhh-primary-dark: #059669;
        }

        /* Override sidebar: solo activo verde */
        .velvz-sidebar__link--active {
            background: rgba(16, 185, 129, 0.15) !important;
            color: #10b981 !important;
        }
        .velvz-sidebar__link--active .velvz-sidebar__icon {
            color: #10b981 !important;
        }

        /* Breadcrumbs hover verde */
        .velvz-breadcrumbs__link:hover {
            color: #10b981 !important;
        }

        /* Estilos para selector de perfil grande */
        .form-select--large {
            padding: 1rem 2.5rem 1rem 1rem;
            font-size: 1.1rem;
        }

        /* Vista previa del perfil */
        .profile-preview {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.08) 0%, rgba(16, 185, 129, 0.03) 100%);
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1.5rem;
        }

        .profile-preview__header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.25rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .profile-preview__header h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #fff;
            margin: 0;
        }

        .profile-preview__dept {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .profile-preview__grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1.25rem;
        }

        .profile-preview__item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        .profile-preview__item i {
            color: #10b981;
            width: 16px;
        }

        .profile-preview__requirements {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .profile-preview__requirements h4 {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
            margin: 0 0 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .profile-preview__tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .profile-preview__tag {
            padding: 0.35rem 0.75rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .profile-preview__tag--essential {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
        }

        .profile-preview__tag--desired {
            background: rgba(245, 158, 11, 0.15);
            color: #f59e0b;
        }

        .profile-preview__tag--nice {
            background: rgba(59, 130, 246, 0.15);
            color: #3b82f6;
        }

        .profile-preview__edit {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
            color: #10b981;
            font-size: 0.9rem;
            text-decoration: none;
            transition: color 0.2s;
        }

        .profile-preview__edit:hover {
            color: #059669;
        }

        /* Estado vacío del perfil */
        .profile-empty {
            text-align: center;
            padding: 3rem 2rem;
            background: rgba(255, 255, 255, 0.02);
            border: 2px dashed rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            margin-top: 1.5rem;
        }

        .profile-empty__icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 1.5rem;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .profile-empty__icon i {
            font-size: 1.75rem;
            color: #10b981;
        }

        .profile-empty h3 {
            font-size: 1.25rem;
            color: #fff;
            margin: 0 0 0.5rem;
        }

        .profile-empty p {
            color: rgba(255, 255, 255, 0.6);
            margin: 0 0 1.5rem;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        /* =====================================================
           INPUT NUMBER CUSTOM
           ===================================================== */
        .number-input-custom {
            position: relative;
            display: flex;
            align-items: stretch;
        }

        .number-input-custom input {
            flex: 1;
            padding-right: 3rem;
            -moz-appearance: textfield;
        }

        .number-input-custom input::-webkit-outer-spin-button,
        .number-input-custom input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .number-input-custom__controls {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            display: flex;
            flex-direction: column;
            width: 2.5rem;
            border-left: 1px solid rgba(255, 255, 255, 0.1);
        }

        .number-input-custom__btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: all 0.2s;
            padding: 0;
        }

        .number-input-custom__btn:hover {
            background: rgba(16, 185, 129, 0.15);
            color: #10b981;
        }

        .number-input-custom__btn:active {
            background: rgba(16, 185, 129, 0.25);
        }

        .number-input-custom__btn:first-child {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0 8px 0 0;
        }

        .number-input-custom__btn:last-child {
            border-radius: 0 0 8px 0;
        }

        .number-input-custom__btn i {
            font-size: 0.7rem;
        }

        /* =====================================================
           INFO BOX LEGAL
           ===================================================== */
        .section-panel--info {
            padding: 0;
        }

        .section-panel--info .info-box {
            margin: 0;
        }

        .info-box--legal {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%);
            border: 1px solid rgba(16, 185, 129, 0.25);
            border-radius: 12px;
            padding: 1.25rem;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        .info-box--legal .info-box__icon {
            width: 40px;
            height: 40px;
            min-width: 40px;
            background: rgba(16, 185, 129, 0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .info-box--legal .info-box__icon i {
            color: #10b981;
            font-size: 1.1rem;
        }

        .info-box--legal h4 {
            color: #10b981;
            font-size: 0.95rem;
            font-weight: 600;
            margin: 0 0 0.35rem;
        }

        .info-box--legal p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.85rem;
            margin: 0;
            line-height: 1.5;
        }

        /* =====================================================
           PROFILE CRITERIA (vista previa del perfil en filtrado)
           ===================================================== */
        .profile-criteria__empty {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.02);
            border: 1px dashed rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.9rem;
        }

        .profile-criteria__empty i {
            color: rgba(255, 255, 255, 0.3);
            font-size: 1.1rem;
        }

        .profile-criteria__content {
            display: grid;
            gap: 1rem;
        }

        .profile-criteria__row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .profile-criteria__item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            padding: 1rem;
        }

        .profile-criteria__item-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .profile-criteria__item-label i {
            color: #10b981;
            font-size: 0.75rem;
        }

        .profile-criteria__item-value {
            font-size: 1rem;
            color: #fff;
            font-weight: 500;
        }

        .profile-criteria__tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .profile-criteria__tag {
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            background: rgba(16, 185, 129, 0.15);
            color: #10b981;
        }

        /* Info box sutil (para explicaciones secundarias) */
        .info-box--subtle {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 1rem 1.25rem;
            margin-top: 1.5rem;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        .info-box--subtle .info-box__icon {
            width: 36px;
            height: 36px;
            min-width: 36px;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .info-box--subtle .info-box__icon i {
            color: #10b981;
            font-size: 1rem;
        }

        .info-box--subtle h4 {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
            font-weight: 600;
            margin: 0 0 0.25rem;
        }

        .info-box--subtle p {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.85rem;
            margin: 0;
            line-height: 1.5;
        }

        .info-box--subtle p strong {
            color: #10b981;
        }

        /* =====================================================
           PROFILE PREVIEW ACTIONS
           ===================================================== */
        .profile-preview__actions {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-top: 1.25rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn--sm {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        /* =====================================================
           MODAL EDITOR SIMPLIFICADO DE PERFIL
           ===================================================== */
        .profile-adjust-overlay {
            position: fixed;
            inset: 0;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .profile-adjust-overlay--active {
            opacity: 1;
            visibility: visible;
        }

        .profile-adjust-overlay__backdrop {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
        }

        .profile-adjust-modal {
            position: relative;
            width: 95%;
            max-width: 700px;
            max-height: 90vh;
            background: linear-gradient(145deg, #1e1e2e 0%, #16161e 100%);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 20px;
            box-shadow:
                0 25px 80px rgba(0, 0, 0, 0.5),
                0 0 60px rgba(16, 185, 129, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
            overflow: hidden;
            transform: scale(0.9) translateY(20px);
            transition: transform 0.3s ease;
        }

        .profile-adjust-overlay--active .profile-adjust-modal {
            transform: scale(1) translateY(0);
        }

        .profile-adjust-modal__header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.25rem 1.5rem;
            background: rgba(16, 185, 129, 0.08);
            border-bottom: 1px solid rgba(16, 185, 129, 0.2);
        }

        .profile-adjust-modal__header-left {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .profile-adjust-modal__icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 1rem;
        }

        .profile-adjust-modal__title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #fff;
            margin: 0;
        }

        .profile-adjust-modal__subtitle {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
            margin: 0.15rem 0 0;
        }

        .profile-adjust-modal__close {
            width: 36px;
            height: 36px;
            border: none;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }

        .profile-adjust-modal__close:hover {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .profile-adjust-modal__body {
            padding: 1.5rem;
            max-height: calc(90vh - 160px);
            overflow-y: auto;
        }

        .profile-adjust-modal__body::-webkit-scrollbar {
            width: 6px;
        }

        .profile-adjust-modal__body::-webkit-scrollbar-track {
            background: transparent;
        }

        .profile-adjust-modal__body::-webkit-scrollbar-thumb {
            background: rgba(16, 185, 129, 0.3);
            border-radius: 3px;
        }

        /* Nota informativa */
        .profile-adjust-note {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 1rem;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 10px;
            margin-bottom: 1.5rem;
        }

        .profile-adjust-note i {
            color: #3b82f6;
            font-size: 1rem;
            margin-top: 0.1rem;
        }

        .profile-adjust-note p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.85rem;
            line-height: 1.5;
            margin: 0;
        }

        .profile-adjust-note strong {
            color: #60a5fa;
        }

        /* Secciones del modal */
        .profile-adjust-section {
            margin-bottom: 1.5rem;
        }

        .profile-adjust-section:last-child {
            margin-bottom: 0;
        }

        .profile-adjust-section__title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 1rem;
        }

        .profile-adjust-section__title i {
            color: #10b981;
            font-size: 0.85rem;
        }

        /* Requisitos editables */
        .adjust-requirements {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .adjust-requirement {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            transition: all 0.2s;
        }

        .adjust-requirement:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .adjust-requirement--excluded {
            opacity: 0.5;
            background: rgba(239, 68, 68, 0.05);
            border-color: rgba(239, 68, 68, 0.2);
        }

        .adjust-requirement--excluded .adjust-requirement__name {
            text-decoration: line-through;
            color: rgba(255, 255, 255, 0.4);
        }

        .adjust-requirement__checkbox {
            width: 18px;
            height: 18px;
            accent-color: #10b981;
            cursor: pointer;
        }

        .adjust-requirement__info {
            flex: 1;
            min-width: 0;
        }

        .adjust-requirement__name {
            font-size: 0.9rem;
            color: #fff;
            font-weight: 500;
        }

        .adjust-requirement__type {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 0.15rem;
        }

        .adjust-requirement__badge {
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .adjust-requirement__badge--essential {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
        }

        .adjust-requirement__badge--desired {
            background: rgba(245, 158, 11, 0.15);
            color: #f59e0b;
        }

        .adjust-requirement__badge--nice {
            background: rgba(59, 130, 246, 0.15);
            color: #3b82f6;
        }

        /* Añadir requisito extra */
        .adjust-add-requirement {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        .adjust-add-requirement input {
            flex: 1;
            padding: 0.6rem 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: #fff;
            font-size: 0.85rem;
        }

        .adjust-add-requirement input:focus {
            outline: none;
            border-color: rgba(16, 185, 129, 0.5);
            background: rgba(16, 185, 129, 0.05);
        }

        .adjust-add-requirement input::placeholder {
            color: rgba(255, 255, 255, 0.3);
        }

        .adjust-add-requirement button {
            padding: 0.6rem 1rem;
            background: rgba(16, 185, 129, 0.15);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 6px;
            color: #10b981;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .adjust-add-requirement button:hover {
            background: rgba(16, 185, 129, 0.25);
        }

        /* Requisitos añadidos para este proceso */
        .adjust-extras {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px dashed rgba(255, 255, 255, 0.1);
        }

        .adjust-extras__title {
            font-size: 0.8rem;
            color: rgba(16, 185, 129, 0.8);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .adjust-extra-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: 6px;
            margin-bottom: 0.5rem;
        }

        .adjust-extra-item span {
            flex: 1;
            font-size: 0.85rem;
            color: #10b981;
        }

        .adjust-extra-item button {
            width: 24px;
            height: 24px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.4);
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .adjust-extra-item button:hover {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        /* Campos editables simples */
        .adjust-field {
            margin-bottom: 1rem;
        }

        .adjust-field:last-child {
            margin-bottom: 0;
        }

        .adjust-field label {
            display: block;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 0.4rem;
        }

        .adjust-field input,
        .adjust-field select {
            width: 100%;
            padding: 0.65rem 0.85rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #fff;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .adjust-field input:focus,
        .adjust-field select:focus {
            outline: none;
            border-color: rgba(16, 185, 129, 0.5);
            background: rgba(16, 185, 129, 0.05);
        }

        .adjust-field-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        /* Footer del modal */
        .profile-adjust-modal__footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.5rem;
            background: rgba(0, 0, 0, 0.2);
            border-top: 1px solid rgba(255, 255, 255, 0.06);
        }

        .profile-adjust-modal__reset {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.5rem 0.75rem;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.85rem;
            cursor: pointer;
            transition: color 0.2s;
        }

        .profile-adjust-modal__reset:hover {
            color: #ef4444;
        }

        .profile-adjust-modal__actions {
            display: flex;
            gap: 0.75rem;
        }

        /* Badge de modificaciones */
        .profile-preview__modified {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.3rem 0.6rem;
            background: rgba(245, 158, 11, 0.15);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 6px;
            font-size: 0.75rem;
            color: #f59e0b;
            margin-left: 0.75rem;
        }

        .profile-preview__modified i {
            font-size: 0.7rem;
        }

        @media (max-width: 600px) {
            .profile-adjust-modal {
                width: 100%;
                max-width: none;
                max-height: 100vh;
                border-radius: 0;
            }

            .profile-adjust-modal__body {
                max-height: calc(100vh - 160px);
            }

            .adjust-field-row {
                grid-template-columns: 1fr;
            }

            .profile-adjust-modal__footer {
                flex-direction: column;
                gap: 1rem;
            }

            .profile-adjust-modal__actions {
                width: 100%;
            }

            .profile-adjust-modal__actions .btn {
                flex: 1;
            }

            .profile-preview__actions {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.75rem;
            }
        }

        /* =====================================================
           ZONA DE PELIGRO - Estilos
           ===================================================== */
        .danger-section {
            margin-top: 2rem;
        }

        .danger-section .section-header {
            border-left: 3px solid #ef4444;
        }

        .section-header__icon--danger {
            background: rgba(239, 68, 68, 0.15) !important;
            color: #ef4444 !important;
        }

        .danger-box {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.08) 0%, rgba(239, 68, 68, 0.03) 100%);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .danger-box__header {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1.25rem;
        }

        .danger-box__header > i {
            font-size: 1.5rem;
            color: #ef4444;
            margin-top: 0.25rem;
        }

        .danger-box__header h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #fff;
            margin: 0 0 0.25rem;
        }

        .danger-box__header p {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
            margin: 0;
        }

        .danger-box__list {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 1rem 1.25rem;
            margin-bottom: 1.25rem;
        }

        .danger-box__list-title {
            display: block;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .danger-box__list ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.5rem;
        }

        .danger-box__list li {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .danger-box__list li i {
            color: #ef4444;
            width: 16px;
            font-size: 0.85rem;
        }

        .danger-box__confirm {
            margin-bottom: 1.25rem;
        }

        .danger-checkbox {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
        }

        .danger-checkbox input {
            display: none;
        }

        .danger-checkbox__box {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(239, 68, 68, 0.5);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .danger-checkbox input:checked + .danger-checkbox__box {
            background: #ef4444;
            border-color: #ef4444;
        }

        .danger-checkbox input:checked + .danger-checkbox__box::after {
            content: '✓';
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .danger-checkbox__text {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .danger-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            padding: 0.875rem 1.5rem;
            background: rgba(239, 68, 68, 0.15);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            color: #ef4444;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: not-allowed;
            opacity: 0.5;
            transition: all 0.2s;
        }

        .danger-btn:not(:disabled) {
            cursor: pointer;
            opacity: 1;
        }

        .danger-btn:not(:disabled):hover {
            background: #ef4444;
            color: white;
            border-color: #ef4444;
        }

        /* =====================================================
           ZONA DE PELIGRO - Usa clases de chatbots (cfg-)
           ===================================================== */
        .danger-zone-container {
            margin-top: 2rem;
        }

        .danger-zone-wrapper {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.08) 0%, rgba(239, 68, 68, 0.03) 100%);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 16px;
            overflow: hidden;
        }

        .danger-zone-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.25rem 1.5rem;
            background: rgba(239, 68, 68, 0.1);
            border-bottom: 1px solid rgba(239, 68, 68, 0.2);
        }

        .danger-zone-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: rgba(239, 68, 68, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ef4444;
            font-size: 1.25rem;
        }

        .danger-zone-title h2 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #ef4444;
            margin: 0 0 0.25rem;
        }

        .danger-zone-title p {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
            margin: 0;
        }

        .danger-zone-content {
            padding: 1.5rem;
        }

        .danger-zone-box__header {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1.25rem;
        }

        .danger-zone-box__header > i {
            font-size: 1.5rem;
            color: #ef4444;
            margin-top: 0.25rem;
        }

        .danger-zone-box__header h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #fff;
            margin: 0 0 0.25rem;
        }

        .danger-zone-box__header p {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
            margin: 0;
        }

        .danger-zone-box__list {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 1rem 1.25rem;
            margin-bottom: 1.25rem;
        }

        .danger-zone-box__list-title {
            display: block;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .danger-zone-box__list ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }

        .danger-zone-box__list li {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .danger-zone-box__list li i {
            color: #ef4444;
            width: 16px;
            font-size: 0.85rem;
        }

        .danger-zone-box__confirm {
            margin-bottom: 1.25rem;
        }

        .danger-zone-checkbox {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
        }

        .danger-zone-checkbox input {
            display: none;
        }

        .danger-zone-checkbox__box {
            width: 22px;
            height: 22px;
            border: 2px solid rgba(239, 68, 68, 0.5);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .danger-zone-checkbox input:checked + .danger-zone-checkbox__box {
            background: #ef4444;
            border-color: #ef4444;
        }

        .danger-zone-checkbox input:checked + .danger-zone-checkbox__box::after {
            content: '✓';
            color: white;
            font-size: 14px;
            font-weight: bold;
        }

        .danger-zone-checkbox__text {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .danger-zone-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            padding: 1rem 1.5rem;
            background: rgba(239, 68, 68, 0.15);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            color: #ef4444;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: not-allowed;
            opacity: 0.5;
            transition: all 0.2s;
        }

        .danger-zone-btn:not(:disabled) {
            cursor: pointer;
            opacity: 1;
        }

        .danger-zone-btn:not(:disabled):hover {
            background: #ef4444;
            color: white;
            border-color: #ef4444;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        /* =====================================================
           TOAST NOTIFICATION
           ===================================================== */
        .toast-notification {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 1.25rem;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 9999;
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .toast-notification--visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .toast-notification--error {
            border-color: rgba(239, 68, 68, 0.3);
        }

        .toast-notification__icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(16, 185, 129, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #10b981;
            font-size: 1rem;
        }

        .toast-notification--error .toast-notification__icon {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .toast-notification__message {
            font-size: 0.95rem;
            color: #fff;
            font-weight: 500;
        }

        .toast-notification__close {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            padding: 0.25rem;
            margin-left: 0.5rem;
            transition: color 0.2s;
        }

        .toast-notification__close:hover {
            color: #fff;
        }

        /* Responsive para toast */
        @media (max-width: 768px) {
            .toast-notification {
                left: 1rem;
                right: 1rem;
                bottom: 1rem;
            }

            .danger-zone-box__list ul {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header class="velvz-header velvz-header--rrhh">
        <div class="velvz-header__container">
            <!-- LOGO -->
            <div class="velvz-header__island velvz-header__island--brand">
                <a href="/app/" class="velvz-header__logo">
                    <div class="velvz-header__logo-shape">
                        <div class="velvz-header__logo-face">
                            <div class="velvz-header__logo-eye"></div>
                            <div class="velvz-header__logo-mouth"></div>
                            <div class="velvz-header__logo-eye"></div>
                        </div>
                    </div>
                </a>
            </div>

            <!-- SELECTOR DE SERVICIOS -->
            <div class="velvz-header__island velvz-header__island--services">
                <button class="svc-selector" id="svcSelector" data-current="rrhh">
                    <i class="fas fa-users svc-selector__icon" style="color: #10b981;"></i>
                    <span class="svc-selector__text">RRHH</span>
                    <i class="fas fa-chevron-down svc-selector__arrow"></i>
                </button>
                <div class="svc-dropdown" id="svcDropdown">
                    <a href="/app/chatbots/dashboard.html" class="svc-dropdown__item" data-service="chatbots">
                        <i class="fas fa-robot"></i>
                        <span>Chatbots</span>
                    </a>
                    <a href="/app/rrhh/" class="svc-dropdown__item svc-dropdown__item--active" data-service="rrhh">
                        <i class="fas fa-users"></i>
                        <span>RRHH</span>
                    </a>
                </div>
            </div>

            <!-- BUSQUEDA -->
            <div class="velvz-header__island velvz-header__island--search">
                <div class="velvz-header__search">
                    <input type="text" class="velvz-header__search-input" placeholder="Buscar..." id="headerSearchInput">
                    <i class="fas fa-search velvz-header__search-icon"></i>
                </div>
            </div>

            <!-- PERFIL -->
            <div class="velvz-header__island velvz-header__island--cta">
                <div class="velvz-header__avatar" id="userAvatar">
                    <div class="velvz-header__avatar-circle">
                        <span id="userInitials">-</span>
                    </div>
                </div>
            </div>

            <!-- TOGGLE MOVIL -->
            <div class="velvz-header__mobile-toggle" id="mobileMenuToggle">
                <div class="velvz-header__hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>

        <!-- MENÚ MÓVIL -->
        <div class="velvz-header__mobile-backdrop"></div>
        <div class="velvz-header__mobile-menu" id="mobileMenu">
            <button class="velvz-header__mobile-close"></button>

            <div class="velvz-header__mobile-content">
                <div class="velvz-header__mobile-search">
                    <div class="velvz-header__mobile-search-container">
                        <i class="fas fa-search velvz-header__mobile-search-icon"></i>
                        <input type="text" class="velvz-header__mobile-search-input" placeholder="Buscar..." id="mobileSearchInput">
                    </div>
                </div>

                <div class="velvz-header__mobile-section">
                    <h3 class="velvz-header__mobile-section-title">RRHH IA</h3>
                    <a href="/app/rrhh/" class="velvz-header__mobile-link">
                        <i class="velvz-header__mobile-link-icon fas fa-th-large"></i>
                        <span>Panel Principal</span>
                    </a>
                </div>

                <div class="velvz-header__mobile-section">
                    <h3 class="velvz-header__mobile-section-title">Gestión</h3>
                    <a href="/app/rrhh/processes/" class="velvz-header__mobile-link velvz-header__mobile-link--active">
                        <i class="velvz-header__mobile-link-icon fas fa-briefcase"></i>
                        <span>Procesos</span>
                    </a>
                    <a href="/app/rrhh/candidates/" class="velvz-header__mobile-link">
                        <i class="velvz-header__mobile-link-icon fas fa-user-tie"></i>
                        <span>Candidatos</span>
                    </a>
                    <a href="/app/rrhh/profiles/" class="velvz-header__mobile-link">
                        <i class="velvz-header__mobile-link-icon fas fa-id-badge"></i>
                        <span>Perfiles</span>
                    </a>
                </div>

                <div class="velvz-header__mobile-section">
                    <h3 class="velvz-header__mobile-section-title">Ajustes</h3>
                    <a href="/app/rrhh/billing/" class="velvz-header__mobile-link">
                        <i class="velvz-header__mobile-link-icon fas fa-gem"></i>
                        <span>Planes</span>
                    </a>
                    <a href="/app/settings/" class="velvz-header__mobile-link">
                        <i class="velvz-header__mobile-link-icon fas fa-cog"></i>
                        <span>Configuración</span>
                    </a>
                </div>

                <div class="velvz-header__mobile-section">
                    <h3 class="velvz-header__mobile-section-title">Cuenta</h3>
                    <a href="/app/profile/" class="velvz-header__mobile-link">
                        <i class="velvz-header__mobile-link-icon fas fa-user"></i>
                        <span>Mi Perfil</span>
                    </a>
                    <a href="#" class="velvz-header__mobile-link" id="mobileLogout">
                        <i class="velvz-header__mobile-link-icon fas fa-sign-out-alt"></i>
                        <span>Cerrar Sesión</span>
                    </a>
                </div>
            </div>

            <div class="velvz-header__mobile-user-card">
                <div class="velvz-header__mobile-user-avatar" id="mobileUserAvatar">
                    <span id="mobileUserInitials">-</span>
                </div>
                <div class="velvz-header__mobile-user-info">
                    <div class="velvz-header__mobile-user-name" id="mobileUserName">Usuario</div>
                    <div class="velvz-header__mobile-user-email" id="mobileUserEmail">usuario@email.com</div>
                </div>
            </div>
        </div>
    </header>

    <!-- LAYOUT PRINCIPAL -->
    <div class="velvz-app">
        <!-- SIDEBAR -->
        <aside class="velvz-sidebar">
            <div class="velvz-sidebar__section">
                <h3 class="velvz-sidebar__title">RRHH IA</h3>
                <ul class="velvz-sidebar__menu">
                    <li class="velvz-sidebar__item">
                        <a href="/app/rrhh/" class="velvz-sidebar__link">
                            <i class="velvz-sidebar__icon fas fa-th-large"></i>
                            <span>Panel Principal</span>
                        </a>
                    </li>
                </ul>
            </div>

            <div class="velvz-sidebar__section">
                <h3 class="velvz-sidebar__title">Gestión</h3>
                <ul class="velvz-sidebar__menu">
                    <li class="velvz-sidebar__item">
                        <a href="/app/rrhh/processes/" class="velvz-sidebar__link velvz-sidebar__link--active">
                            <i class="velvz-sidebar__icon fas fa-briefcase"></i>
                            <span>Procesos</span>
                        </a>
                    </li>
                    <li class="velvz-sidebar__item">
                        <a href="/app/rrhh/candidates/" class="velvz-sidebar__link">
                            <i class="velvz-sidebar__icon fas fa-user-tie"></i>
                            <span>Candidatos</span>
                        </a>
                    </li>
                    <li class="velvz-sidebar__item">
                        <a href="/app/rrhh/profiles/" class="velvz-sidebar__link">
                            <i class="velvz-sidebar__icon fas fa-id-badge"></i>
                            <span>Perfiles</span>
                        </a>
                    </li>
                </ul>
            </div>

            <div class="velvz-sidebar__section">
                <h3 class="velvz-sidebar__title">Ajustes</h3>
                <ul class="velvz-sidebar__menu">
                    <li class="velvz-sidebar__item">
                        <a href="/app/plans/" class="velvz-sidebar__link">
                            <i class="velvz-sidebar__icon fas fa-gem"></i>
                            <span>Planes</span>
                        </a>
                    </li>
                    <li class="velvz-sidebar__item">
                        <a href="/app/settings/" class="velvz-sidebar__link">
                            <i class="velvz-sidebar__icon fas fa-cog"></i>
                            <span>Configuración</span>
                        </a>
                    </li>
                </ul>
            </div>
        </aside>

        <!-- MAIN -->
        <main class="velvz-main">
            <div class="process-editor">
                <!-- HEADER DEL EDITOR -->
                <div class="process-editor__header">
                    <!-- Breadcrumbs -->
                    <nav class="velvz-breadcrumbs">
                        <a href="/app/rrhh/" class="velvz-breadcrumbs__link">
                            <i class="fas fa-users" style="margin-right: 0.35rem;"></i>RRHH
                        </a>
                        <span class="velvz-breadcrumbs__separator">
                            <i class="fas fa-chevron-right"></i>
                        </span>
                        <a href="/app/rrhh/processes/" class="velvz-breadcrumbs__link">Procesos</a>
                        <span class="velvz-breadcrumbs__separator">
                            <i class="fas fa-chevron-right"></i>
                        </span>
                        <span class="velvz-breadcrumbs__current">Nuevo Proceso</span>
                    </nav>

                    <!-- Titulo y acciones -->
                    <div class="process-editor__title-row">
                        <div class="process-editor__title-group">
                            <h1 class="process-editor__title" id="processTitle">Nuevo Proceso de Selección</h1>
                            <div class="process-editor__status">
                                <span class="process-status process-status--draft">
                                    <i class="fas fa-pencil-alt"></i>
                                    Borrador
                                </span>
                            </div>
                        </div>
                        <div class="process-editor__actions">
                            <button class="btn btn--secondary" id="previewBtn">
                                <i class="fas fa-eye"></i>
                                <span>Vista Previa</span>
                            </button>
                            <button class="btn btn--primary" id="saveBtn">
                                <i class="fas fa-save"></i>
                                <span>Guardar</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- NAVEGACIÓN DE SECCIONES (estilo chatbots) -->
                <div class="velvz-config__tabs">
                    <div class="velvz-config__tabs-nav">
                        <button class="velvz-config__tab velvz-config__tab--active" data-tab="position">
                            <i class="fas fa-id-badge"></i>
                            <span>Perfil</span>
                        </button>
                        <button class="velvz-config__tab" data-tab="filtering">
                            <i class="fas fa-filter"></i>
                            <span>Filtrado</span>
                        </button>
                        <button class="velvz-config__tab" data-tab="interview">
                            <i class="fas fa-robot"></i>
                            <span>Entrevista IA</span>
                        </button>
                        <button class="velvz-config__tab" data-tab="documents">
                            <i class="fas fa-folder"></i>
                            <span>Documentos</span>
                        </button>
                        <button class="velvz-config__tab" data-tab="summary">
                            <i class="fas fa-chart-pie"></i>
                            <span>Resumen</span>
                        </button>
                    </div>
                </div>

                <!-- CONTENIDO DE LAS SECCIONES -->
                <div class="process-editor__content">

                    <!-- ===== SECCIÓN 1: SELECCIÓN DE PERFIL ===== -->
                    <section class="process-section process-section--active" data-tab="position">

                        <!-- Panel: Selección de Perfil -->
                        <div class="section-panel">
                            <div class="section-panel__header">
                                <div class="section-panel__icon">
                                    <i class="fas fa-id-badge"></i>
                                </div>
                                <div class="section-panel__title">
                                    <h2>Selección de Perfil</h2>
                                    <p>Selecciona el perfil de puesto para este proceso de selección</p>
                                </div>
                            </div>

                            <div class="section-panel__body">
                                <!-- Selector de perfil -->
                                <div class="form-field">
                                    <label class="form-label">
                                        Perfil de Puesto
                                        <span class="form-required">*</span>
                                    </label>
                                    <div class="form-select-wrapper">
                                        <select class="form-select form-select--large" id="profileSelect">
                                            <option value="">Selecciona un perfil existente...</option>
                                            <option value="new">+ Crear nuevo perfil</option>
                                        </select>
                                        <i class="fas fa-chevron-down form-select-icon"></i>
                                    </div>
                                    <span class="form-hint">El perfil contiene toda la información del puesto (requisitos, salario, ubicación, etc.)</span>
                                </div>

                                <!-- Vista previa del perfil seleccionado -->
                                <div class="profile-preview" id="profilePreview" style="display: none;">
                                    <div class="profile-preview__header">
                                        <h3 id="previewTitle">-</h3>
                                        <span class="profile-preview__dept" id="previewDept">-</span>
                                    </div>
                                    <div class="profile-preview__grid">
                                        <div class="profile-preview__item">
                                            <i class="fas fa-map-marker-alt"></i>
                                            <span id="previewLocation">-</span>
                                        </div>
                                        <div class="profile-preview__item">
                                            <i class="fas fa-building"></i>
                                            <span id="previewModality">-</span>
                                        </div>
                                        <div class="profile-preview__item">
                                            <i class="fas fa-euro-sign"></i>
                                            <span id="previewSalary">-</span>
                                        </div>
                                        <div class="profile-preview__item">
                                            <i class="fas fa-clock"></i>
                                            <span id="previewExperience">-</span>
                                        </div>
                                    </div>
                                    <div class="profile-preview__requirements">
                                        <h4>Requisitos del Perfil</h4>
                                        <div class="profile-preview__tags" id="previewRequirements">
                                            <!-- Tags de requisitos -->
                                        </div>
                                    </div>
                                    <div class="profile-preview__actions">
                                        <button type="button" class="btn btn--secondary btn--sm" id="adjustProfileBtn">
                                            <i class="fas fa-sliders-h"></i>
                                            Ajustar para este proceso
                                        </button>
                                        <a href="/app/rrhh/profiles/editor.html" class="profile-preview__edit" id="editProfileLink">
                                            <i class="fas fa-external-link-alt"></i>
                                            Editar perfil completo
                                        </a>
                                    </div>
                                </div>

                                <!-- Mensaje cuando no hay perfil -->
                                <div class="profile-empty" id="profileEmpty">
                                    <div class="profile-empty__icon">
                                        <i class="fas fa-id-badge"></i>
                                    </div>
                                    <h3>Selecciona un perfil</h3>
                                    <p>Elige un perfil de puesto existente o crea uno nuevo para configurar este proceso de selección.</p>
                                    <a href="/app/rrhh/profiles/editor.html?new=1" class="btn btn--secondary">
                                        <i class="fas fa-plus"></i>
                                        Crear nuevo perfil
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Panel: Configuración del Proceso -->
                        <div class="section-panel">
                            <div class="section-panel__header">
                                <div class="section-panel__icon">
                                    <i class="fas fa-cog"></i>
                                </div>
                                <div class="section-panel__title">
                                    <h2>Configuración del Proceso</h2>
                                    <p>Datos específicos de este proceso de selección</p>
                                </div>
                            </div>

                            <div class="section-panel__body">
                                <div class="form-grid form-grid--2">
                                    <div class="form-field">
                                        <label class="form-label">
                                            Nombre del Proceso
                                            <span class="form-required">*</span>
                                        </label>
                                        <input type="text" class="form-input" id="processName" placeholder="Ej: Backend Developer - Enero 2025">
                                        <span class="form-hint">Identifica este proceso de selección específico</span>
                                    </div>

                                    <div class="form-field">
                                        <label class="form-label">Vacantes</label>
                                        <div class="number-input-custom">
                                            <input type="number" class="form-input" id="numPositions" value="1" min="1">
                                            <div class="number-input-custom__controls">
                                                <button type="button" class="number-input-custom__btn" data-action="increment">
                                                    <i class="fas fa-chevron-up"></i>
                                                </button>
                                                <button type="button" class="number-input-custom__btn" data-action="decrement">
                                                    <i class="fas fa-chevron-down"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <span class="form-hint">Número de posiciones a cubrir</span>
                                    </div>
                                </div>

                                <div class="form-grid form-grid--2">
                                    <div class="form-field">
                                        <label class="form-label">Fecha de Inicio</label>
                                        <input type="date" class="form-input" id="startDate">
                                        <span class="form-hint">Cuándo se abre el proceso</span>
                                    </div>

                                    <div class="form-field">
                                        <label class="form-label">Fecha Límite</label>
                                        <input type="date" class="form-input" id="endDate">
                                        <span class="form-hint">Fecha límite para aplicar</span>
                                    </div>
                                </div>

                                <div class="form-field">
                                    <label class="form-label">Notas Internas (opcional)</label>
                                    <textarea class="form-textarea" id="internalNotes" rows="3" placeholder="Notas privadas sobre este proceso (solo visibles para el equipo de RRHH)"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Navegación -->
                        <div class="section-nav">
                            <div></div>
                            <button class="btn btn--primary btn--next" data-next="filtering">
                                Siguiente: Filtrado
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </section>

                    <!-- ===== SECCIÓN 2: FILTRADO ===== -->
                    <section class="process-section" data-tab="filtering">

                        <!-- Panel: Criterios de filtrado del perfil -->
                        <div class="section-panel">
                            <div class="section-panel__header">
                                <div class="section-panel__icon">
                                    <i class="fas fa-clipboard-check"></i>
                                </div>
                                <div class="section-panel__title">
                                    <h2>Criterios del Perfil</h2>
                                    <p>Estos criterios se heredan del perfil seleccionado y se usarán para filtrar candidatos</p>
                                </div>
                            </div>

                            <div class="section-panel__body">
                                <!-- Resumen de criterios del perfil (solo lectura) -->
                                <div class="profile-criteria" id="profileCriteria">
                                    <div class="profile-criteria__empty">
                                        <i class="fas fa-info-circle"></i>
                                        <span>Selecciona un perfil en la pestaña anterior para ver los criterios de filtrado</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Panel: Requisitos legales -->
                        <div class="section-panel">
                            <div class="section-panel__header">
                                <div class="section-panel__icon">
                                    <i class="fas fa-gavel"></i>
                                </div>
                                <div class="section-panel__title">
                                    <h2>Requisitos Legales</h2>
                                    <p>Criterios adicionales relacionados con permisos y disponibilidad</p>
                                </div>
                            </div>

                            <div class="section-panel__body">
                                <div class="form-grid form-grid--2">
                                    <div class="form-field">
                                        <label class="form-label">Permiso de trabajo</label>
                                        <div class="form-select-wrapper">
                                            <select class="form-select" id="workPermit">
                                                <option value="not_required">No requerido</option>
                                                <option value="spain">Permiso de trabajo en España</option>
                                                <option value="eu">Permiso de trabajo en la UE</option>
                                            </select>
                                            <i class="fas fa-chevron-down form-select-icon"></i>
                                        </div>
                                        <span class="form-hint">Solo si es requisito legal para el puesto</span>
                                    </div>

                                    <div class="form-field">
                                        <label class="form-label">Disponibilidad de incorporación</label>
                                        <div class="form-select-wrapper">
                                            <select class="form-select" id="availability">
                                                <option value="any">Cualquier momento</option>
                                                <option value="immediate">Inmediata</option>
                                                <option value="15days">En 15 días</option>
                                                <option value="1month">En 1 mes</option>
                                                <option value="2months">En 2 meses</option>
                                            </select>
                                            <i class="fas fa-chevron-down form-select-icon"></i>
                                        </div>
                                        <span class="form-hint">Tiempo máximo para incorporarse</span>
                                    </div>
                                </div>

                                <div class="form-grid form-grid--2">
                                    <div class="form-field">
                                        <label class="form-label">Disponibilidad para viajar</label>
                                        <div class="form-select-wrapper">
                                            <select class="form-select" id="travelAvailability">
                                                <option value="not_required">No requerido</option>
                                                <option value="occasional">Ocasional (< 25%)</option>
                                                <option value="frequent">Frecuente (25-50%)</option>
                                                <option value="high">Alta (> 50%)</option>
                                            </select>
                                            <i class="fas fa-chevron-down form-select-icon"></i>
                                        </div>
                                        <span class="form-hint">Solo si el puesto lo requiere</span>
                                    </div>

                                    <div class="form-field">
                                        <label class="form-label">Carnet de conducir</label>
                                        <div class="form-select-wrapper">
                                            <select class="form-select" id="drivingLicense">
                                                <option value="not_required">No requerido</option>
                                                <option value="b">Tipo B (coche)</option>
                                                <option value="c">Tipo C (camión)</option>
                                                <option value="d">Tipo D (autobús)</option>
                                            </select>
                                            <i class="fas fa-chevron-down form-select-icon"></i>
                                        </div>
                                        <span class="form-hint">Solo si es necesario para el puesto</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Panel: Límite de candidaturas -->
                        <div class="section-panel">
                            <div class="section-panel__header">
                                <div class="section-panel__icon">
                                    <i class="fas fa-inbox"></i>
                                </div>
                                <div class="section-panel__title">
                                    <h2>Límite de Candidaturas</h2>
                                    <p>Gestiona la capacidad de recepción de este proceso</p>
                                </div>
                            </div>

                            <div class="section-panel__body">
                                <div class="form-grid form-grid--2">
                                    <div class="form-field">
                                        <label class="form-label">Candidaturas máximas</label>
                                        <div class="number-input-custom">
                                            <input type="number" class="form-input" id="maxCandidates" value="100" min="1">
                                            <div class="number-input-custom__controls">
                                                <button type="button" class="number-input-custom__btn" data-action="increment">
                                                    <i class="fas fa-chevron-up"></i>
                                                </button>
                                                <button type="button" class="number-input-custom__btn" data-action="decrement">
                                                    <i class="fas fa-chevron-down"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <span class="form-hint">Número máximo de CVs a recibir (por orden de llegada)</span>
                                    </div>

                                    <div class="form-field">
                                        <label class="form-label">Al alcanzar el límite</label>
                                        <div class="form-select-wrapper">
                                            <select class="form-select" id="limitAction">
                                                <option value="close">Cerrar proceso automáticamente</option>
                                                <option value="notify">Solo notificarme</option>
                                                <option value="waitlist">Añadir a lista de espera</option>
                                            </select>
                                            <i class="fas fa-chevron-down form-select-icon"></i>
                                        </div>
                                        <span class="form-hint">Qué hacer cuando se alcance el límite</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Panel: Opciones adicionales -->
                        <div class="section-panel">
                            <div class="section-panel__header">
                                <div class="section-panel__icon">
                                    <i class="fas fa-sliders-h"></i>
                                </div>
                                <div class="section-panel__title">
                                    <h2>Opciones del Proceso</h2>
                                    <p>Configura aspectos adicionales de la evaluación</p>
                                </div>
                            </div>

                            <div class="section-panel__body">
                                <div class="toggle-options">
                                    <label class="toggle-option">
                                        <input type="checkbox" id="cvRequired" checked>
                                        <span class="toggle-option__slider"></span>
                                        <div class="toggle-option__content">
                                            <span class="toggle-option__label">CV obligatorio</span>
                                            <span class="toggle-option__hint">Requerir currículum para aplicar al proceso</span>
                                        </div>
                                    </label>
                                    <label class="toggle-option">
                                        <input type="checkbox" id="coverLetterOptional">
                                        <span class="toggle-option__slider"></span>
                                        <div class="toggle-option__content">
                                            <span class="toggle-option__label">Carta de presentación</span>
                                            <span class="toggle-option__hint">Permitir adjuntar carta de presentación (opcional)</span>
                                        </div>
                                    </label>
                                    <label class="toggle-option">
                                        <input type="checkbox" id="anonymousScreening">
                                        <span class="toggle-option__slider"></span>
                                        <div class="toggle-option__content">
                                            <span class="toggle-option__label">Evaluación ciega</span>
                                            <span class="toggle-option__hint">Ocultar nombre y foto durante la evaluación inicial (recomendado)</span>
                                        </div>
                                    </label>
                                    <label class="toggle-option">
                                        <input type="checkbox" id="autoNotifications" checked>
                                        <span class="toggle-option__slider"></span>
                                        <div class="toggle-option__content">
                                            <span class="toggle-option__label">Notificaciones automáticas</span>
                                            <span class="toggle-option__hint">Enviar emails automáticos de confirmación y actualización de estado</span>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Navegación -->
                        <div class="section-nav">
                            <button class="btn btn--secondary btn--prev" data-prev="position">
                                <i class="fas fa-arrow-left"></i>
                                Anterior
                            </button>
                            <button class="btn btn--primary btn--next" data-next="interview">
                                Siguiente: Entrevista IA
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </section>

                    <!-- ===== SECCIÓN 3: ENTREVISTA IA ===== -->
                    <section class="process-section" data-tab="interview">
                        <div class="section-panel">
                            <div class="section-panel__header">
                                <div class="section-panel__icon">
                                    <i class="fas fa-robot"></i>
                                </div>
                                <div class="section-panel__title">
                                    <h2>Configuración de Entrevista IA</h2>
                                    <p>Define cómo la IA entrevistará a los candidatos</p>
                                </div>
                            </div>

                            <div class="section-panel__body">
                                <!-- Tipo de entrevista -->
                                <div class="form-field">
                                    <label class="form-label">Tipo de Entrevista</label>
                                    <div class="interview-types">
                                        <label class="interview-type interview-type--selected">
                                            <input type="radio" name="interviewType" value="conversational" checked>
                                            <div class="interview-type__content">
                                                <i class="fas fa-comments"></i>
                                                <span class="interview-type__title">Conversacional</span>
                                                <span class="interview-type__desc">Chat natural que evalúa al candidato</span>
                                            </div>
                                        </label>
                                        <label class="interview-type">
                                            <input type="radio" name="interviewType" value="structured">
                                            <div class="interview-type__content">
                                                <i class="fas fa-list-ol"></i>
                                                <span class="interview-type__title">Estructurada</span>
                                                <span class="interview-type__desc">Preguntas predefinidas en orden</span>
                                            </div>
                                        </label>
                                        <label class="interview-type">
                                            <input type="radio" name="interviewType" value="technical">
                                            <div class="interview-type__content">
                                                <i class="fas fa-code"></i>
                                                <span class="interview-type__title">Técnica</span>
                                                <span class="interview-type__desc">Incluye ejercicios y casos prácticos</span>
                                            </div>
                                        </label>
                                    </div>
                                </div>

                                <!-- Instrucciones para la IA -->
                                <div class="form-field form-field--highlight">
                                    <div class="form-label-row">
                                        <label class="form-label">
                                            <i class="fas fa-brain"></i>
                                            Instrucciones para la IA
                                            <span class="form-required">*</span>
                                        </label>
                                    </div>
                                    <textarea class="form-textarea form-textarea--large" id="aiInstructions" rows="6" placeholder="Define el objetivo de la entrevista, qué información debe obtener la IA, cómo debe comportarse, qué tono usar...

Ejemplo: 'Eres un entrevistador amable pero profesional. Tu objetivo es evaluar la experiencia técnica del candidato en Python y AWS, su capacidad de trabajo en equipo, y su motivación para unirse a nuestra empresa. Haz preguntas abiertas y profundiza en las respuestas interesantes.'"></textarea>
                                    <div class="form-field__footer">
                                        <span class="form-hint">Sé específico sobre qué quieres que la IA descubra del candidato</span>
                                        <span class="form-counter"><span id="aiInstructionsCount">0</span>/3000</span>
                                    </div>
                                </div>

                                <!-- Aspectos a evaluar -->
                                <div class="form-field">
                                    <label class="form-label">Aspectos a Evaluar</label>
                                    <div class="evaluation-aspects" id="evaluationAspects">
                                        <div class="evaluation-aspect">
                                            <input type="checkbox" id="aspectMotivation" checked>
                                            <label for="aspectMotivation">
                                                <i class="fas fa-fire"></i>
                                                Motivación
                                            </label>
                                        </div>
                                        <div class="evaluation-aspect">
                                            <input type="checkbox" id="aspectCulture" checked>
                                            <label for="aspectCulture">
                                                <i class="fas fa-handshake"></i>
                                                Fit Cultural
                                            </label>
                                        </div>
                                        <div class="evaluation-aspect">
                                            <input type="checkbox" id="aspectCommunication" checked>
                                            <label for="aspectCommunication">
                                                <i class="fas fa-comment-dots"></i>
                                                Comunicación
                                            </label>
                                        </div>
                                        <div class="evaluation-aspect">
                                            <input type="checkbox" id="aspectProblemSolving" checked>
                                            <label for="aspectProblemSolving">
                                                <i class="fas fa-lightbulb"></i>
                                                Resolución de Problemas
                                            </label>
                                        </div>
                                        <div class="evaluation-aspect">
                                            <input type="checkbox" id="aspectLeadership">
                                            <label for="aspectLeadership">
                                                <i class="fas fa-crown"></i>
                                                Liderazgo
                                            </label>
                                        </div>
                                        <div class="evaluation-aspect">
                                            <input type="checkbox" id="aspectTeamwork" checked>
                                            <label for="aspectTeamwork">
                                                <i class="fas fa-users"></i>
                                                Trabajo en Equipo
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Configuración adicional -->
                                <div class="form-grid form-grid--2">
                                    <div class="form-field">
                                        <label class="form-label">Duración Estimada</label>
                                        <div class="form-select-wrapper">
                                            <select class="form-select" id="interviewDuration">
                                                <option value="10">10 minutos</option>
                                                <option value="15" selected>15 minutos</option>
                                                <option value="20">20 minutos</option>
                                                <option value="30">30 minutos</option>
                                                <option value="45">45 minutos</option>
                                            </select>
                                            <i class="fas fa-chevron-down form-select-icon"></i>
                                        </div>
                                    </div>
                                    <div class="form-field">
                                        <label class="form-label">Idioma de la Entrevista</label>
                                        <div class="form-select-wrapper">
                                            <select class="form-select" id="interviewLanguage">
                                                <option value="es" selected>Español</option>
                                                <option value="en">Inglés</option>
                                                <option value="auto">Detectar automáticamente</option>
                                            </select>
                                            <i class="fas fa-chevron-down form-select-icon"></i>
                                        </div>
                                    </div>
                                </div>

                                <!-- Preguntas personalizadas -->
                                <div class="form-field">
                                    <label class="form-label">Preguntas Personalizadas (opcional)</label>
                                    <div class="custom-questions" id="customQuestions">
                                        <!-- Se añaden dinámicamente -->
                                    </div>
                                    <button class="btn btn--add-requirement" id="addQuestionBtn">
                                        <i class="fas fa-plus"></i>
                                        Añadir pregunta que la IA debe hacer
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Navegación -->
                        <div class="section-nav">
                            <button class="btn btn--secondary btn--prev" data-prev="filtering">
                                <i class="fas fa-arrow-left"></i>
                                Anterior
                            </button>
                            <button class="btn btn--primary btn--next" data-next="documents">
                                Siguiente: Documentos
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </section>

                    <!-- ===== SECCIÓN 4: DOCUMENTOS ===== -->
                    <section class="process-section" data-tab="documents">
                        <div class="section-panel">
                            <div class="section-panel__header">
                                <div class="section-panel__icon">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <div class="section-panel__title">
                                    <h2>Documentos de Contexto</h2>
                                    <p>Sube documentos que la IA usará durante las entrevistas</p>
                                </div>
                            </div>

                            <div class="section-panel__body">
                                <!-- Explicación -->
                                <div class="info-box">
                                    <div class="info-box__icon">
                                        <i class="fas fa-lightbulb"></i>
                                    </div>
                                    <div class="info-box__content">
                                        <h4>¿Para qué sirven estos documentos?</h4>
                                        <p>Puedes subir documentos de tu empresa (resúmenes, proyectos, organigramas) y dar instrucciones a la IA sobre cómo usarlos. Por ejemplo, la IA puede verificar sutilmente si el candidato ha trabajado con empresas mencionadas en tus documentos.</p>
                                    </div>
                                </div>

                                <!-- Zona de subida -->
                                <div class="upload-zone" id="uploadZone">
                                    <div class="upload-zone__content">
                                        <div class="upload-zone__icon">
                                            <i class="fas fa-cloud-upload-alt"></i>
                                        </div>
                                        <h3>Arrastra documentos aquí</h3>
                                        <p>o haz clic para seleccionar archivos</p>
                                        <span class="upload-zone__hint">PDF, DOC, DOCX, TXT - Máx. 10MB por archivo</span>
                                    </div>
                                    <input type="file" id="fileInput" multiple accept=".pdf,.doc,.docx,.txt" hidden>
                                </div>

                                <!-- Lista de documentos -->
                                <div class="documents-list" id="documentsList">
                                    <!-- Se añaden dinámicamente -->
                                </div>

                                <!-- Instrucciones para documentos -->
                                <div class="form-field form-field--highlight" style="margin-top: 2rem;">
                                    <div class="form-label-row">
                                        <label class="form-label">
                                            <i class="fas fa-magic"></i>
                                            Instrucciones de Uso de Documentos
                                        </label>
                                    </div>
                                    <textarea class="form-textarea form-textarea--large" id="documentInstructions" rows="5" placeholder="Explica a la IA cómo usar estos documentos. Ejemplos:

• 'Usa el resumen de la empresa para verificar sutilmente si el candidato ha trabajado con las empresas mencionadas'
• 'Compara la experiencia del candidato con los proyectos del documento de casos de éxito'
• 'No menciones directamente estos documentos al candidato'
• 'Si el candidato menciona alguna empresa del documento, profundiza en esa experiencia'"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Panel: CVs de candidatos -->
                        <div class="section-panel">
                            <div class="section-panel__header">
                                <div class="section-panel__icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="section-panel__title">
                                    <h2>Currículums de Candidatos</h2>
                                    <p>Sube los CVs de los candidatos para que la IA los analice</p>
                                </div>
                            </div>

                            <div class="section-panel__body">
                                <div class="upload-zone upload-zone--secondary" id="cvUploadZone">
                                    <div class="upload-zone__content">
                                        <div class="upload-zone__icon">
                                            <i class="fas fa-file-user"></i>
                                        </div>
                                        <h3>Sube currículums</h3>
                                        <p>La IA analizará cada CV y lo comparará con los requisitos</p>
                                        <span class="upload-zone__hint">Puedes subir múltiples CVs a la vez</span>
                                    </div>
                                    <input type="file" id="cvFileInput" multiple accept=".pdf,.doc,.docx" hidden>
                                </div>

                                <div class="cv-stats" id="cvStats" style="display: none;">
                                    <div class="cv-stat">
                                        <span class="cv-stat__number" id="cvCount">0</span>
                                        <span class="cv-stat__label">CVs subidos</span>
                                    </div>
                                    <div class="cv-stat">
                                        <span class="cv-stat__number" id="cvAnalyzed">0</span>
                                        <span class="cv-stat__label">Analizados</span>
                                    </div>
                                    <div class="cv-stat">
                                        <span class="cv-stat__number" id="cvPending">0</span>
                                        <span class="cv-stat__label">Pendientes</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Navegación -->
                        <div class="section-nav">
                            <button class="btn btn--secondary btn--prev" data-prev="interview">
                                <i class="fas fa-arrow-left"></i>
                                Anterior
                            </button>
                            <button class="btn btn--primary btn--next" data-next="summary">
                                Siguiente: Resumen
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </section>

                    <!-- ===== SECCIÓN 5: RESUMEN ===== -->
                    <section class="process-section" data-tab="summary">
                        <div class="section-panel">
                            <div class="section-panel__header">
                                <div class="section-panel__icon">
                                    <i class="fas fa-chart-pie"></i>
                                </div>
                                <div class="section-panel__title">
                                    <h2>Resumen del Proceso</h2>
                                    <p>Vista general y estado del proceso de selección</p>
                                </div>
                            </div>

                            <div class="section-panel__body">
                                <!-- Estado del proceso -->
                                <div class="summary-status">
                                    <div class="summary-status__badge summary-status__badge--draft">
                                        <i class="fas fa-pencil-alt"></i>
                                        Borrador
                                    </div>
                                    <p>Este proceso aún no ha sido publicado. Revisa la configuración y publícalo cuando esté listo.</p>
                                </div>

                                <!-- Resumen de configuración -->
                                <div class="summary-grid">
                                    <div class="summary-card">
                                        <div class="summary-card__header">
                                            <i class="fas fa-id-badge"></i>
                                            <h3>Perfil</h3>
                                            <button class="summary-card__edit" data-goto="position">
                                                <i class="fas fa-pen"></i>
                                            </button>
                                        </div>
                                        <div class="summary-card__body">
                                            <div class="summary-item">
                                                <span class="summary-item__label">Perfil:</span>
                                                <span class="summary-item__value" id="summaryProfile">Sin seleccionar</span>
                                            </div>
                                            <div class="summary-item">
                                                <span class="summary-item__label">Departamento:</span>
                                                <span class="summary-item__value" id="summaryDepartment">-</span>
                                            </div>
                                            <div class="summary-item">
                                                <span class="summary-item__label">Ubicación:</span>
                                                <span class="summary-item__value" id="summaryLocation">-</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="summary-card">
                                        <div class="summary-card__header">
                                            <i class="fas fa-cog"></i>
                                            <h3>Proceso</h3>
                                            <button class="summary-card__edit" data-goto="position">
                                                <i class="fas fa-pen"></i>
                                            </button>
                                        </div>
                                        <div class="summary-card__body">
                                            <div class="summary-item">
                                                <span class="summary-item__label">Nombre:</span>
                                                <span class="summary-item__value" id="summaryTitle">Sin definir</span>
                                            </div>
                                            <div class="summary-item">
                                                <span class="summary-item__label">Vacantes:</span>
                                                <span class="summary-item__value" id="summaryVacancies">1</span>
                                            </div>
                                            <div class="summary-item">
                                                <span class="summary-item__label">Fecha límite:</span>
                                                <span class="summary-item__value" id="summaryDeadline">Sin definir</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="summary-card">
                                        <div class="summary-card__header">
                                            <i class="fas fa-filter"></i>
                                            <h3>Filtrado</h3>
                                            <button class="summary-card__edit" data-goto="filtering">
                                                <i class="fas fa-pen"></i>
                                            </button>
                                        </div>
                                        <div class="summary-card__body">
                                            <div class="summary-item">
                                                <span class="summary-item__label">Máx. candidatos:</span>
                                                <span class="summary-item__value" id="summaryMaxCandidates">100</span>
                                            </div>
                                            <div class="summary-item">
                                                <span class="summary-item__label">Descarte inicial:</span>
                                                <span class="summary-item__value" id="summaryDiscard">50%</span>
                                            </div>
                                            <div class="summary-item">
                                                <span class="summary-item__label">Finalistas:</span>
                                                <span class="summary-item__value" id="summaryFinalists">10</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="summary-card">
                                        <div class="summary-card__header">
                                            <i class="fas fa-robot"></i>
                                            <h3>Entrevista IA</h3>
                                            <button class="summary-card__edit" data-goto="interview">
                                                <i class="fas fa-pen"></i>
                                            </button>
                                        </div>
                                        <div class="summary-card__body">
                                            <div class="summary-item">
                                                <span class="summary-item__label">Tipo:</span>
                                                <span class="summary-item__value" id="summaryInterviewType">Conversacional</span>
                                            </div>
                                            <div class="summary-item">
                                                <span class="summary-item__label">Duración:</span>
                                                <span class="summary-item__value" id="summaryDuration">15 min</span>
                                            </div>
                                            <div class="summary-item">
                                                <span class="summary-item__label">Documentos:</span>
                                                <span class="summary-item__value" id="summaryDocs">0</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Métricas (cuando esté activo) -->
                                <div class="summary-metrics" id="summaryMetrics" style="display: none;">
                                    <h3>Métricas del Proceso</h3>
                                    <div class="metrics-grid">
                                        <div class="metric-card">
                                            <div class="metric-card__value" id="metricTotal">0</div>
                                            <div class="metric-card__label">Candidatos Totales</div>
                                        </div>
                                        <div class="metric-card">
                                            <div class="metric-card__value" id="metricInterviews">0</div>
                                            <div class="metric-card__label">Entrevistas Completadas</div>
                                        </div>
                                        <div class="metric-card">
                                            <div class="metric-card__value" id="metricPending">0</div>
                                            <div class="metric-card__label">Pendientes de Revisión</div>
                                        </div>
                                        <div class="metric-card">
                                            <div class="metric-card__value" id="metricConversion">0%</div>
                                            <div class="metric-card__label">Tasa de Conversión</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Acciones finales -->
                                <div class="summary-actions">
                                    <button class="btn btn--secondary btn--large" id="saveDraftBtn">
                                        <i class="fas fa-save"></i>
                                        Guardar Borrador
                                    </button>
                                    <button class="btn btn--primary btn--large" id="publishBtn">
                                        <i class="fas fa-rocket"></i>
                                        Publicar Proceso
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- ZONA DE PELIGRO - Solo visible al editar proceso existente -->
                        <div class="danger-zone-container" id="dangerZoneContainer" style="display: none;">
                            <div class="danger-zone-wrapper">
                                <div class="danger-zone-header">
                                    <div class="danger-zone-icon">
                                        <i class="fas fa-exclamation-triangle"></i>
                                    </div>
                                    <div class="danger-zone-title">
                                        <h2>Zona de Peligro</h2>
                                        <p>Acciones irreversibles que afectarán permanentemente a este proceso</p>
                                    </div>
                                </div>

                                <div class="danger-zone-content">
                                    <div class="danger-zone-box">
                                        <div class="danger-zone-box__header">
                                            <i class="fas fa-trash-alt"></i>
                                            <div>
                                                <h3>Eliminar Proceso de Selección</h3>
                                                <p>Esta acción eliminará permanentemente este proceso y toda su información asociada.</p>
                                            </div>
                                        </div>

                                        <div class="danger-zone-box__list">
                                            <span class="danger-zone-box__list-title">Se eliminará permanentemente:</span>
                                            <ul>
                                                <li><i class="fas fa-clipboard-list"></i> Configuración del proceso</li>
                                                <li><i class="fas fa-users"></i> Todos los candidatos asociados</li>
                                                <li><i class="fas fa-comments"></i> Entrevistas y evaluaciones</li>
                                                <li><i class="fas fa-chart-line"></i> Estadísticas e historial</li>
                                            </ul>
                                        </div>

                                        <div class="danger-zone-box__confirm">
                                            <label class="danger-zone-checkbox">
                                                <input type="checkbox" id="dangerConfirmCheckbox" data-ignore-changes="true">
                                                <span class="danger-zone-checkbox__box"></span>
                                                <span class="danger-zone-checkbox__text">Entiendo que esta acción no se puede deshacer</span>
                                            </label>
                                        </div>

                                        <button type="button" class="danger-zone-btn" id="dangerDeleteBtn" disabled>
                                            <i class="fas fa-trash-alt"></i>
                                            Eliminar Proceso Permanentemente
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Navegación -->
                        <div class="section-nav">
                            <button class="btn btn--secondary btn--prev" data-prev="documents">
                                <i class="fas fa-arrow-left"></i>
                                Anterior
                            </button>
                            <div></div>
                        </div>
                    </section>

                </div>
            </div>
        </main>
    </div>

    <!-- NOTIFICACIÓN TOAST -->
    <div class="toast-notification" id="toastNotification">
        <div class="toast-notification__icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="toast-notification__content">
            <span class="toast-notification__message">Cambios guardados correctamente</span>
        </div>
        <button class="toast-notification__close" onclick="hideToast()">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- FOOTER -->
    <footer class="velvz-footer">
        <div class="velvz-footer__container">
            <div class="velvz-footer__brand">
                <a href="/" class="velvz-footer__logo-link">
                    <div class="velvz-footer__logo">
                        <div class="velvz-footer__logo-shape">
                            <div class="velvz-footer__logo-face">
                                <div class="velvz-footer__logo-eye velvz-footer__logo-eye--left"></div>
                                <div class="velvz-footer__logo-mouth"></div>
                                <div class="velvz-footer__logo-eye velvz-footer__logo-eye--right"></div>
                            </div>
                        </div>
                    </div>
                    <span class="velvz-footer__brand-name">Velvz</span>
                </a>
                <p class="velvz-footer__tagline">IA conversacional para empresas</p>
            </div>

            <nav class="velvz-footer__links">
                <a href="/" class="velvz-footer__link">Inicio</a>
                <a href="/servicios/" class="velvz-footer__link">Servicios</a>
                <a href="/precios/" class="velvz-footer__link">Precios</a>
                <a href="/documentacion/" class="velvz-footer__link">Documentación</a>
                <a href="/contacto/" class="velvz-footer__link">Contacto</a>
            </nav>

            <div class="velvz-footer__legal">
                <div class="velvz-footer__copyright">© 2025 Velvz SL</div>
                <div>
                    <a href="/privacidad/" class="velvz-footer__link">Privacidad</a> ·
                    <a href="/terminos/" class="velvz-footer__link">Términos</a> ·
                    <a href="/cookies/" class="velvz-footer__link">Cookies</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- MODAL: EDITOR SIMPLIFICADO DE PERFIL -->
    <div class="profile-adjust-overlay" id="profileAdjustOverlay">
        <div class="profile-adjust-overlay__backdrop" id="profileAdjustBackdrop"></div>
        <div class="profile-adjust-modal">
            <div class="profile-adjust-modal__header">
                <div class="profile-adjust-modal__header-left">
                    <div class="profile-adjust-modal__icon">
                        <i class="fas fa-sliders-h"></i>
                    </div>
                    <div>
                        <h2 class="profile-adjust-modal__title">Ajustes para este proceso</h2>
                        <p class="profile-adjust-modal__subtitle" id="adjustModalProfileName">Desarrollador Backend Senior</p>
                    </div>
                </div>
                <button class="profile-adjust-modal__close" id="profileAdjustClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="profile-adjust-modal__body">
                <!-- Nota informativa -->
                <div class="profile-adjust-note">
                    <i class="fas fa-info-circle"></i>
                    <p>Estos ajustes <strong>solo afectan a este proceso</strong>. El perfil original no se modificará. Puedes excluir requisitos o añadir otros específicos para esta búsqueda.</p>
                </div>

                <!-- Sección: Requisitos -->
                <div class="profile-adjust-section">
                    <h3 class="profile-adjust-section__title">
                        <i class="fas fa-clipboard-check"></i>
                        Requisitos del Perfil
                    </h3>
                    <div class="adjust-requirements" id="adjustRequirementsList">
                        <!-- Se llena dinámicamente -->
                    </div>

                    <!-- Añadir requisito extra -->
                    <div class="adjust-add-requirement">
                        <input type="text" id="adjustNewRequirement" placeholder="Añadir requisito específico para este proceso...">
                        <button type="button" id="adjustAddReqBtn">
                            <i class="fas fa-plus"></i> Añadir
                        </button>
                    </div>

                    <!-- Requisitos añadidos -->
                    <div class="adjust-extras" id="adjustExtras" style="display: none;">
                        <div class="adjust-extras__title">
                            <i class="fas fa-plus-circle"></i>
                            Añadidos para este proceso:
                        </div>
                        <div id="adjustExtrasList">
                            <!-- Se llena dinámicamente -->
                        </div>
                    </div>
                </div>

                <!-- Sección: Ajustes de condiciones -->
                <div class="profile-adjust-section">
                    <h3 class="profile-adjust-section__title">
                        <i class="fas fa-cog"></i>
                        Condiciones (solo para este proceso)
                    </h3>
                    <div class="adjust-field-row">
                        <div class="adjust-field">
                            <label>Salario mínimo (€/año)</label>
                            <input type="number" id="adjustSalaryMin" placeholder="Heredado del perfil">
                        </div>
                        <div class="adjust-field">
                            <label>Salario máximo (€/año)</label>
                            <input type="number" id="adjustSalaryMax" placeholder="Heredado del perfil">
                        </div>
                    </div>
                    <div class="adjust-field-row">
                        <div class="adjust-field">
                            <label>Experiencia mínima (años)</label>
                            <input type="number" id="adjustExperience" placeholder="Heredado del perfil" min="0">
                        </div>
                        <div class="adjust-field">
                            <label>Modalidad</label>
                            <select id="adjustModality">
                                <option value="">Heredado del perfil</option>
                                <option value="onsite">Presencial</option>
                                <option value="remote">Remoto</option>
                                <option value="hybrid">Híbrido</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div class="profile-adjust-modal__footer">
                <button type="button" class="profile-adjust-modal__reset" id="adjustResetBtn">
                    <i class="fas fa-undo"></i>
                    Restablecer todo
                </button>
                <div class="profile-adjust-modal__actions">
                    <button type="button" class="btn btn--secondary" id="adjustCancelBtn">
                        Cancelar
                    </button>
                    <button type="button" class="btn btn--primary" id="adjustSaveBtn">
                        <i class="fas fa-check"></i>
                        Aplicar ajustes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="/assets/js/app-dashboard.js"></script>
    <script>
        // =====================================================
        // INPUTS NUMBER CUSTOM
        // =====================================================
        document.querySelectorAll('.number-input-custom').forEach(wrapper => {
            const input = wrapper.querySelector('input');
            const btnUp = wrapper.querySelector('[data-action="increment"]');
            const btnDown = wrapper.querySelector('[data-action="decrement"]');

            if (btnUp) {
                btnUp.addEventListener('click', () => {
                    const max = input.max ? parseInt(input.max) : Infinity;
                    const current = parseInt(input.value) || 0;
                    if (current < max) {
                        input.value = current + 1;
                        input.dispatchEvent(new Event('change'));
                    }
                });
            }

            if (btnDown) {
                btnDown.addEventListener('click', () => {
                    const min = input.min ? parseInt(input.min) : 0;
                    const current = parseInt(input.value) || 0;
                    if (current > min) {
                        input.value = current - 1;
                        input.dispatchEvent(new Event('change'));
                    }
                });
            }
        });

        // =====================================================
        // API Y DATOS
        // =====================================================
        const API_URL = window.API_CONFIG?.API_URL || 'https://velvz-unified-backend-production.up.railway.app';
        let profilesData = [];
        let selectedProfile = null;
        let currentProcessId = null;
        let hasUnsavedChanges = false;
        let originalFormData = null;

        // =====================================================
        // TOAST NOTIFICATIONS
        // =====================================================
        function showToast(message, isError = false) {
            const toast = document.getElementById('toastNotification');
            const messageEl = toast.querySelector('.toast-notification__message');
            const iconEl = toast.querySelector('.toast-notification__icon i');

            messageEl.textContent = message;

            if (isError) {
                toast.classList.add('toast-notification--error');
                iconEl.className = 'fas fa-exclamation-circle';
            } else {
                toast.classList.remove('toast-notification--error');
                iconEl.className = 'fas fa-check-circle';
            }

            toast.classList.add('toast-notification--visible');

            setTimeout(() => {
                hideToast();
            }, 4000);
        }

        function hideToast() {
            const toast = document.getElementById('toastNotification');
            toast.classList.remove('toast-notification--visible');
        }

        // =====================================================
        // SISTEMA DE DETECCIÓN DE CAMBIOS
        // =====================================================
        function getFormData() {
            return {
                title: document.getElementById('processName')?.value || '',
                description: document.getElementById('processDescription')?.value || '',
                num_positions: document.getElementById('numPositions')?.value || '1',
                priority: document.getElementById('priority')?.value || 'normal',
                deadline: document.getElementById('deadline')?.value || '',
                hiring_manager: document.getElementById('hiringManager')?.value || '',
                profile_id: document.getElementById('profileSelect')?.value || '',
                ai_interview_enabled: document.getElementById('aiInterviewToggle')?.checked || false
            };
        }

        function checkForChanges() {
            if (!originalFormData) return;

            const currentData = getFormData();
            const changed = JSON.stringify(currentData) !== JSON.stringify(originalFormData);

            if (changed && !hasUnsavedChanges) {
                markAsChanged();
            } else if (!changed && hasUnsavedChanges) {
                hasUnsavedChanges = false;
                updateSaveButtonState();
                hideUnsavedChangesWarning();
            }
        }

        function updateSaveButtonState() {
            // Función mantenida por compatibilidad pero sin indicador visual
            // El estado de cambios sin guardar se maneja internamente
        }

        function initChangeDetection() {
            // Guardar estado original después de cargar (más tiempo para procesos existentes)
            setTimeout(() => {
                originalFormData = getFormData();
                console.log('📝 Estado original guardado:', originalFormData);
            }, 1000);

            // Función para añadir listener solo a inputs que no deben ignorarse
            function addChangeListener(input) {
                // Ignorar inputs marcados con data-ignore-changes
                if (input.dataset.ignoreChanges === 'true') return;
                // Ignorar inputs dentro de la zona de peligro
                if (input.closest('.danger-zone-container')) return;
                // Ignorar inputs dentro del modal de eliminación
                if (input.closest('.velvz-delete-modal')) return;

                input.addEventListener('input', () => markAsChanged());
                input.addEventListener('change', () => markAsChanged());
            }

            // Escuchar cambios en todos los inputs actuales
            const formInputs = document.querySelectorAll('input, select, textarea');
            formInputs.forEach(input => addChangeListener(input));

            // Observer para detectar inputs dinámicos
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    mutation.addedNodes.forEach((node) => {
                        if (node.nodeType === 1) {
                            const inputs = node.querySelectorAll ? node.querySelectorAll('input, select, textarea') : [];
                            inputs.forEach(input => addChangeListener(input));
                        }
                    });
                });
            });
            observer.observe(document.body, { childList: true, subtree: true });

            // Prevenir salir con cambios sin guardar
            window.addEventListener('beforeunload', (e) => {
                if (hasUnsavedChanges) {
                    e.preventDefault();
                    e.returnValue = '';
                    return '';
                }
            });
        }

        // =====================================================
        // SISTEMA DE CAMBIOS SIN GUARDAR (ESTILO CHATBOTS)
        // =====================================================
        function showUnsavedChangesWarning() {
            let warningBar = document.getElementById('unsavedChangesWarning');

            if (!warningBar) {
                warningBar = document.createElement('div');
                warningBar.id = 'unsavedChangesWarning';
                warningBar.innerHTML = `
                    <div class="unsaved-warning__main">
                        <i class="fas fa-circle" style="font-size: 8px; color: #f59e0b;"></i>
                        <span>Cambios sin guardar</span>
                    </div>
                    <div class="unsaved-warning__actions">
                        <button type="button" class="unsaved-warning__btn unsaved-warning__btn--discard" id="discardChangesBtn">
                            <i class="fas fa-times"></i>
                            Descartar
                        </button>
                        <button type="button" class="unsaved-warning__btn unsaved-warning__btn--save" id="saveChangesQuickBtn">
                            <i class="fas fa-save"></i>
                            Guardar
                        </button>
                    </div>
                `;
                warningBar.style.cssText = `
                    position: fixed !important;
                    bottom: 20px !important;
                    right: 20px !important;
                    background: rgba(30, 41, 59, 0.98) !important;
                    color: #e2e8f0 !important;
                    padding: 12px 18px !important;
                    border-radius: 10px !important;
                    display: flex !important;
                    flex-direction: column !important;
                    gap: 0px !important;
                    z-index: 999999 !important;
                    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4) !important;
                    font-size: 14px !important;
                    font-weight: 600 !important;
                    border-left: 4px solid #f59e0b !important;
                    pointer-events: auto !important;
                    opacity: 1 !important;
                    visibility: visible !important;
                    cursor: pointer !important;
                    transition: all 0.25s ease !important;
                    overflow: hidden !important;
                `;

                // Añadir estilos
                if (!document.getElementById('unsavedChangesStyles')) {
                    const style = document.createElement('style');
                    style.id = 'unsavedChangesStyles';
                    style.textContent = `
                        @keyframes slideUp {
                            from { opacity: 0; transform: translateY(10px); }
                            to { opacity: 1; transform: translateY(0); }
                        }
                        #unsavedChangesWarning {
                            animation: slideUp 0.3s ease forwards !important;
                        }
                        #unsavedChangesWarning .unsaved-warning__main {
                            display: flex;
                            align-items: center;
                            gap: 10px;
                        }
                        #unsavedChangesWarning .unsaved-warning__actions {
                            display: flex;
                            gap: 8px;
                            margin-top: 0;
                            max-height: 0;
                            opacity: 0;
                            overflow: hidden;
                            transition: all 0.25s ease;
                        }
                        #unsavedChangesWarning:hover .unsaved-warning__actions {
                            max-height: 50px;
                            opacity: 1;
                            margin-top: 12px;
                        }
                        #unsavedChangesWarning .unsaved-warning__btn {
                            display: flex;
                            align-items: center;
                            gap: 6px;
                            padding: 8px 14px;
                            border: none;
                            border-radius: 6px;
                            font-size: 13px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.2s ease;
                            flex: 1;
                            justify-content: center;
                        }
                        #unsavedChangesWarning .unsaved-warning__btn--discard {
                            background: rgba(255, 255, 255, 0.1);
                            color: #e2e8f0;
                        }
                        #unsavedChangesWarning .unsaved-warning__btn--discard:hover {
                            background: rgba(239, 68, 68, 0.2);
                            color: #fca5a5;
                        }
                        #unsavedChangesWarning .unsaved-warning__btn--save {
                            background: linear-gradient(135deg, #10b981, #059669);
                            color: white;
                        }
                        #unsavedChangesWarning .unsaved-warning__btn--save:hover {
                            background: linear-gradient(135deg, #059669, #047857);
                            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
                        }
                    `;
                    document.head.appendChild(style);
                }

                document.body.appendChild(warningBar);

                // Event listeners
                warningBar.querySelector('#discardChangesBtn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (confirm('¿Descartar cambios sin guardar?')) {
                        window.location.reload();
                    }
                });

                warningBar.querySelector('#saveChangesQuickBtn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    const saveDraftBtn = document.getElementById('saveDraftBtn');
                    if (saveDraftBtn) saveDraftBtn.click();
                });
            }

            warningBar.style.display = 'flex';
        }

        function hideUnsavedChangesWarning() {
            const warningBar = document.getElementById('unsavedChangesWarning');
            if (warningBar) {
                warningBar.style.display = 'none';
            }
        }

        function markAsChanged() {
            if (!hasUnsavedChanges) {
                hasUnsavedChanges = true;
                updateSaveButtonState();
                showUnsavedChangesWarning();
            }
        }

        // =====================================================
        // NAVEGACIÓN POR TABS/SECCIONES
        // =====================================================
        function setupTabNavigation() {
            const tabs = document.querySelectorAll('.velvz-config__tab');
            const sections = document.querySelectorAll('.process-section');

            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetTab = this.dataset.tab;

                    // Actualizar tabs activos
                    tabs.forEach(t => t.classList.remove('velvz-config__tab--active'));
                    this.classList.add('velvz-config__tab--active');

                    // Mostrar sección correspondiente
                    sections.forEach(section => {
                        if (section.dataset.tab === targetTab) {
                            section.classList.add('process-section--active');
                            section.style.display = 'block';
                        } else {
                            section.classList.remove('process-section--active');
                            section.style.display = 'none';
                        }
                    });
                });
            });

            // Botones siguiente/anterior dentro de secciones
            document.querySelectorAll('.btn--next').forEach(btn => {
                btn.addEventListener('click', function() {
                    const nextTab = this.dataset.next;
                    if (nextTab) {
                        const targetTabBtn = document.querySelector(`.velvz-config__tab[data-tab="${nextTab}"]`);
                        if (targetTabBtn) targetTabBtn.click();
                    }
                });
            });

            document.querySelectorAll('.btn--prev').forEach(btn => {
                btn.addEventListener('click', function() {
                    const prevTab = this.dataset.prev;
                    if (prevTab) {
                        const targetTabBtn = document.querySelector(`.velvz-config__tab[data-tab="${prevTab}"]`);
                        if (targetTabBtn) targetTabBtn.click();
                    }
                });
            });

            // Botones de editar en resumen
            document.querySelectorAll('.summary-card__edit').forEach(btn => {
                btn.addEventListener('click', function() {
                    const targetTab = this.dataset.goto;
                    if (targetTab) {
                        const targetTabBtn = document.querySelector(`.velvz-config__tab[data-tab="${targetTab}"]`);
                        if (targetTabBtn) targetTabBtn.click();
                    }
                });
            });
        }

        // Inicializar navegación al cargar
        setupTabNavigation();

        // =====================================================
        // CARGAR PERFILES DESDE BACKEND
        // =====================================================
        const profileSelect = document.getElementById('profileSelect');
        const processNameInput = document.getElementById('processName');
        const profilePreview = document.getElementById('profilePreview');
        const profileEmpty = document.getElementById('profileEmpty');

        async function loadProfiles() {
            try {
                const token = window.velvzAuth?.getToken();
                if (!token) {
                    console.log('No hay sesión');
                    return;
                }

                const response = await fetch(`${API_URL}/api/rrhh/profiles`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.message || 'Error al cargar perfiles');
                }

                profilesData = result.data.profiles;

                // Limpiar y poblar el select
                profileSelect.innerHTML = '<option value="">Selecciona un perfil existente...</option>';

                if (profilesData.length === 0) {
                    profileSelect.innerHTML += '<option value="new" disabled>No hay perfiles - Crea uno primero</option>';
                } else {
                    profilesData.forEach(p => {
                        const opt = document.createElement('option');
                        opt.value = p.id;
                        opt.textContent = p.name;
                        opt.dataset.profile = JSON.stringify(p);
                        profileSelect.appendChild(opt);
                    });
                    profileSelect.innerHTML += '<option value="new">+ Crear nuevo perfil</option>';
                }

                console.log(`✅ ${profilesData.length} perfiles cargados`);

            } catch (error) {
                console.error('Error cargando perfiles:', error);
            }
        }

        // Helpers de formato
        function formatDepartment(dept) {
            const labels = {
                tech: 'Tecnología', product: 'Producto', design: 'Diseño',
                sales: 'Ventas', marketing: 'Marketing', hr: 'RRHH',
                finance: 'Finanzas', operations: 'Operaciones', other: 'Otro'
            };
            return labels[dept] || dept || 'Sin departamento';
        }

        function formatModality(mod) {
            const labels = { onsite: 'Presencial', remote: 'Remoto', hybrid: 'Híbrido' };
            return labels[mod] || mod || 'Sin especificar';
        }

        function formatSalary(min, max) {
            if (!min && !max) return 'No especificado';
            const fmt = n => n >= 1000 ? Math.round(n/1000) + 'k' : n;
            if (min && max) return `${fmt(min)} - ${fmt(max)}€`;
            if (min) return `Desde ${fmt(min)}€`;
            return `Hasta ${fmt(max)}€`;
        }

        // Mostrar vista previa del perfil
        function showProfilePreview(profile) {
            selectedProfile = profile;

            document.getElementById('previewTitle').textContent = profile.name;
            document.getElementById('previewDept').textContent = formatDepartment(profile.department);
            document.getElementById('previewLocation').textContent = profile.location || 'Sin especificar';
            document.getElementById('previewModality').textContent = formatModality(profile.modality);
            document.getElementById('previewSalary').textContent = formatSalary(profile.salary_min, profile.salary_max);
            document.getElementById('previewExperience').textContent = profile.min_experience_years ? `${profile.min_experience_years}+ años` : 'Sin especificar';

            // Requisitos
            const requirements = typeof profile.requirements === 'string'
                ? JSON.parse(profile.requirements)
                : profile.requirements || {};

            const reqContainer = document.getElementById('previewRequirements');
            reqContainer.innerHTML = '';

            const allReqs = [
                ...(requirements.essential || []).map(r => ({ name: r, type: 'essential' })),
                ...(requirements.desired || []).map(r => ({ name: r, type: 'desired' })),
                ...(requirements.niceToHave || []).map(r => ({ name: r, type: 'nice' }))
            ];

            if (allReqs.length === 0) {
                reqContainer.innerHTML = '<span style="color: rgba(255,255,255,0.5); font-size: 0.9rem;">Sin requisitos definidos</span>';
            } else {
                allReqs.forEach(req => {
                    const tag = document.createElement('span');
                    tag.className = `profile-preview__tag profile-preview__tag--${req.type}`;
                    tag.textContent = req.name;
                    reqContainer.appendChild(tag);
                });
            }

            // Actualizar enlace de editar perfil
            document.getElementById('editProfileLink').href = `/app/rrhh/profiles/editor.html?id=${profile.id}`;

            // Mostrar preview, ocultar empty
            profilePreview.style.display = 'block';
            profileEmpty.style.display = 'none';
        }

        function hideProfilePreview() {
            selectedProfile = null;
            profilePreview.style.display = 'none';
            profileEmpty.style.display = 'block';
        }

        function getMonthName() {
            const months = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                           'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
            const now = new Date();
            return `${months[now.getMonth()]} ${now.getFullYear()}`;
        }

        if (profileSelect && processNameInput) {
            profileSelect.addEventListener('change', function() {
                const value = this.value;

                if (value === 'new') {
                    window.location.href = '/app/rrhh/profiles/editor.html?redirect=process';
                    return;
                }

                if (!value) {
                    hideProfilePreview();
                    return;
                }

                // Buscar perfil en los datos cargados
                const profile = profilesData.find(p => p.id == value);
                if (profile) {
                    showProfilePreview(profile);

                    // Auto-generar nombre del proceso
                    if (!processNameInput.value || processNameInput.dataset.autoGenerated === 'true') {
                        processNameInput.value = `${profile.name} - ${getMonthName()}`;
                        processNameInput.dataset.autoGenerated = 'true';
                    }
                }
            });

            // Si el usuario modifica el nombre, ya no es auto-generado
            processNameInput.addEventListener('input', function() {
                this.dataset.autoGenerated = 'false';
            });
        }

        // =====================================================
        // GUARDAR PROCESO
        // =====================================================
        const saveDraftBtn = document.getElementById('saveDraftBtn');
        const publishBtn = document.getElementById('publishBtn');
        let isSaving = false;

        async function saveProcess(status = 'draft') {
            console.log('🔄 Iniciando saveProcess con status:', status);
            console.log('   - currentProcessId:', currentProcessId);
            console.log('   - selectedProfile:', selectedProfile);
            console.log('   - isSaving:', isSaving);

            if (isSaving) {
                console.log('❌ Ya hay un guardado en proceso');
                return;
            }

            // Validar perfil seleccionado
            if (!selectedProfile) {
                console.log('❌ No hay perfil seleccionado');
                if (window.VelvzNotify) {
                    VelvzNotify.warning('Por favor, selecciona un perfil de puesto');
                } else {
                    showToast('Por favor, selecciona un perfil de puesto', true);
                }
                profileSelect.focus();
                return;
            }

            // Validar nombre del proceso
            const processName = document.getElementById('processName').value.trim();
            if (!processName) {
                showToast('Por favor, introduce un nombre para el proceso', true);
                document.getElementById('processName').focus();
                return;
            }

            isSaving = true;
            const btn = status === 'draft' ? saveDraftBtn : publishBtn;
            const saveBtn = document.getElementById('saveBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Guardando...';
            btn.disabled = true;
            if (saveBtn) saveBtn.disabled = true;

            try {
                const token = window.velvzAuth?.getToken();
                if (!token) {
                    showToast('Tu sesión ha expirado', true);
                    window.location.href = '/auth/login.html';
                    return;
                }

                // Recoger datos del formulario
                const data = {
                    title: processName,
                    profile_id: selectedProfile.id,
                    description: document.getElementById('processDescription')?.value || '',
                    num_positions: parseInt(document.getElementById('numPositions')?.value) || 1,
                    priority: document.getElementById('priority')?.value || 'normal',
                    deadline: document.getElementById('deadline')?.value || null,
                    location: selectedProfile.location,
                    modality: selectedProfile.modality,
                    salary_min: selectedProfile.salary_min,
                    salary_max: selectedProfile.salary_max,
                    salary_period: selectedProfile.salary_period || 'year',
                    hiring_manager: document.getElementById('hiringManager')?.value || null,
                    ai_interview_enabled: document.getElementById('aiInterviewToggle')?.checked || false,
                    profile_adjustments: window.profileAdjustModal?.getAdjustments() || {},
                    status: status
                };

                const isEditing = !!currentProcessId;
                const url = isEditing
                    ? `${API_URL}/api/rrhh/processes/${currentProcessId}`
                    : `${API_URL}/api/rrhh/processes`;
                const method = isEditing ? 'PUT' : 'POST';

                console.log(`📤 ${isEditing ? 'Actualizando' : 'Creando'} proceso:`);
                console.log('   - URL:', url);
                console.log('   - Method:', method);
                console.log('   - Data:', data);

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(data)
                });

                console.log('📥 Response status:', response.status);
                const result = await response.json();
                console.log('📥 Response body:', result);

                if (result.success) {
                    console.log('✅ Proceso guardado:', result.data.process);

                    // Si es nuevo proceso, actualizar la URL y el ID
                    if (!currentProcessId && result.data.process.id) {
                        currentProcessId = result.data.process.id;
                        // Actualizar URL sin recargar
                        const newUrl = `${window.location.pathname}?id=${currentProcessId}`;
                        window.history.replaceState({}, '', newUrl);
                        // Mostrar zona de peligro ahora que tenemos ID
                        initDangerZone();
                    }

                    // Marcar como sin cambios pendientes
                    hasUnsavedChanges = false;
                    originalFormData = getFormData();
                    updateSaveButtonState();
                    hideUnsavedChangesWarning();

                    // Usar sistema de notificaciones global (igual que chatbots)
                    if (window.VelvzNotify) {
                        VelvzNotify.saved();
                    } else {
                        showToast(status === 'draft' ? 'Borrador guardado' : 'Proceso publicado');
                    }
                } else {
                    throw new Error(result.message || 'Error al guardar el proceso');
                }
            } catch (error) {
                console.error('Error guardando proceso:', error);
                if (window.VelvzNotify) {
                    VelvzNotify.error(error.message, 'Error al guardar');
                } else {
                    showToast('Error al guardar: ' + error.message, true);
                }
            } finally {
                isSaving = false;
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        // Botón guardar del header
        const headerSaveBtn = document.getElementById('saveBtn');
        if (headerSaveBtn) {
            headerSaveBtn.addEventListener('click', () => saveProcess('draft'));
        }

        if (saveDraftBtn) {
            saveDraftBtn.addEventListener('click', () => saveProcess('draft'));
        }
        if (publishBtn) {
            publishBtn.addEventListener('click', () => saveProcess('active'));
        }

        // =====================================================
        // CARGAR PROCESO EXISTENTE (si hay ?id= en URL)
        // =====================================================
        const urlParams = new URLSearchParams(window.location.search);
        const processId = urlParams.get('id');

        async function loadProcess(id) {
            console.log('📂 loadProcess iniciado con id:', id);
            try {
                const token = window.velvzAuth?.getToken();
                if (!token) {
                    alert('Tu sesión ha expirado. Por favor, inicia sesión de nuevo.');
                    window.location.href = '/auth/login.html';
                    return false;
                }

                console.log('📤 Fetching proceso desde:', `${API_URL}/api/rrhh/processes/${id}`);
                const response = await fetch(`${API_URL}/api/rrhh/processes/${id}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const result = await response.json();
                console.log('📥 Respuesta del servidor:', result);

                if (!result.success) {
                    throw new Error(result.message || 'Proceso no encontrado');
                }

                const process = result.data.process;
                currentProcessId = process.id;
                console.log('✅ currentProcessId establecido a:', currentProcessId);

                // Actualizar título de la página
                document.getElementById('processTitle').textContent = 'Editar Proceso de Selección';
                document.querySelector('.velvz-breadcrumbs__current').textContent = 'Editar Proceso';

                // Rellenar formulario
                document.getElementById('processName').value = process.title || '';
                document.getElementById('processName').dataset.autoGenerated = 'false';

                if (document.getElementById('processDescription')) {
                    document.getElementById('processDescription').value = process.description || '';
                }
                if (document.getElementById('numPositions')) {
                    document.getElementById('numPositions').value = process.num_positions || 1;
                }
                if (document.getElementById('priority')) {
                    document.getElementById('priority').value = process.priority || 'normal';
                }
                if (document.getElementById('deadline')) {
                    document.getElementById('deadline').value = process.deadline ? process.deadline.split('T')[0] : '';
                }
                if (document.getElementById('hiringManager')) {
                    document.getElementById('hiringManager').value = process.hiring_manager || '';
                }
                if (document.getElementById('aiInterviewToggle')) {
                    document.getElementById('aiInterviewToggle').checked = process.ai_interview_enabled || false;
                }

                // Seleccionar perfil después de cargar perfiles
                await loadProfiles();

                if (process.profile_id) {
                    profileSelect.value = process.profile_id;
                    const profile = profilesData.find(p => p.id == process.profile_id);
                    if (profile) {
                        showProfilePreview(profile);
                    }
                }

                // Cargar ajustes del perfil si existen
                if (process.profile_adjustments) {
                    const adjustments = typeof process.profile_adjustments === 'string'
                        ? JSON.parse(process.profile_adjustments)
                        : process.profile_adjustments;

                    if (window.profileAdjustModal) {
                        // Los ajustes se cargarán cuando se abra el modal
                    }
                }

                console.log('✅ Proceso cargado:', process.title);
                console.log('   - selectedProfile después de cargar:', selectedProfile);
                return true;

            } catch (error) {
                console.error('❌ Error cargando proceso:', error);
                alert('Error al cargar el proceso: ' + error.message);
                window.location.href = '/app/rrhh/processes/';
                return false;
            }
        }

        // =====================================================
        // ZONA DE PELIGRO - Inicializar con modal estilo chatbots
        // =====================================================
        function initDangerZone() {
            console.log('🔴 initDangerZone llamado');
            console.log('   - currentProcessId:', currentProcessId);

            const dangerContainer = document.getElementById('dangerZoneContainer');
            const confirmCheckbox = document.getElementById('dangerConfirmCheckbox');
            const deleteBtn = document.getElementById('dangerDeleteBtn');

            console.log('   - dangerContainer encontrado:', !!dangerContainer);

            // Mostrar zona de peligro solo en modo edición (cuando hay un ID de proceso)
            if (currentProcessId && dangerContainer) {
                dangerContainer.style.display = 'block';
                console.log('✅ Zona de peligro VISIBLE para proceso:', currentProcessId);
            } else {
                console.log('❌ Zona de peligro NO mostrada - currentProcessId:', currentProcessId, 'dangerContainer:', !!dangerContainer);
            }

            // Habilitar/deshabilitar botón según checkbox
            if (confirmCheckbox && deleteBtn) {
                confirmCheckbox.addEventListener('change', function() {
                    deleteBtn.disabled = !this.checked;
                });
            }

            // Manejar click en eliminar - Abrir modal de confirmación
            if (deleteBtn) {
                deleteBtn.addEventListener('click', function() {
                    if (!confirmCheckbox || !confirmCheckbox.checked) return;
                    showDeleteProcessModal();
                });
            }
        }

        // =====================================================
        // MODAL DE ELIMINACIÓN - Estilo chatbots
        // =====================================================
        function createDeleteProcessModal() {
            if (document.getElementById('deleteProcessModal')) {
                return document.getElementById('deleteProcessModal');
            }

            const modal = document.createElement('div');
            modal.id = 'deleteProcessModal';
            modal.className = 'velvz-delete-modal';
            modal.innerHTML = `
                <div class="velvz-delete-modal__backdrop"></div>
                <div class="velvz-delete-modal__container">
                    <div class="velvz-delete-modal__content">
                        <div class="velvz-delete-modal__header">
                            <div class="velvz-delete-modal__icon">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <h2 class="velvz-delete-modal__title">
                                ¿Eliminar proceso permanentemente?
                            </h2>
                            <button type="button" class="velvz-delete-modal__close" id="deleteModalClose">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>

                        <div class="velvz-delete-modal__body">
                            <div class="velvz-delete-modal__warning">
                                <p class="velvz-delete-modal__process-name">
                                    Estás a punto de eliminar: <strong id="processNameToDelete"></strong>
                                </p>
                                <p class="velvz-delete-modal__description">
                                    Esta acción es <strong>permanente e irreversible</strong>.
                                    Se eliminarán todos los candidatos, entrevistas y datos asociados.
                                </p>
                            </div>

                            <div class="velvz-delete-modal__confirm-section">
                                <label class="velvz-delete-modal__label">
                                    Para confirmar, escribe <strong>ELIMINAR</strong> en el campo de abajo:
                                </label>
                                <input
                                    type="text"
                                    id="deleteConfirmInput"
                                    class="velvz-delete-modal__input"
                                    placeholder="Escribe ELIMINAR"
                                    autocomplete="off"
                                >
                                <small class="velvz-delete-modal__hint" id="deleteHint"></small>
                            </div>
                        </div>

                        <div class="velvz-delete-modal__footer">
                            <button type="button" class="velvz-delete-modal__btn velvz-delete-modal__btn--cancel" id="deleteModalCancel">
                                Cancelar
                            </button>
                            <button type="button" class="velvz-delete-modal__btn velvz-delete-modal__btn--delete" id="deleteModalConfirm" disabled>
                                <i class="fas fa-trash-alt"></i>
                                <span>Eliminar Permanentemente</span>
                            </button>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // Estilos CSS del modal
            if (!document.getElementById('deleteModalStyles')) {
                const styles = document.createElement('style');
                styles.id = 'deleteModalStyles';
                styles.textContent = `
                    .velvz-delete-modal {
                        position: fixed;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        z-index: 10000;
                        display: none;
                    }
                    .velvz-delete-modal--open {
                        display: block;
                    }
                    .velvz-delete-modal__backdrop {
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background: rgba(0, 0, 0, 0.8);
                        backdrop-filter: blur(8px);
                        animation: modalFadeIn 0.3s ease;
                    }
                    .velvz-delete-modal__container {
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        padding: 2rem;
                        pointer-events: none;
                    }
                    .velvz-delete-modal__content {
                        background: #1a1a2e;
                        border: 2px solid rgba(239, 68, 68, 0.3);
                        border-radius: 20px;
                        max-width: 500px;
                        width: 100%;
                        max-height: 90vh;
                        overflow-y: auto;
                        pointer-events: all;
                        animation: modalSlideUp 0.3s ease;
                        box-shadow: 0 20px 60px rgba(239, 68, 68, 0.2);
                    }
                    .velvz-delete-modal__header {
                        display: flex;
                        align-items: center;
                        gap: 1rem;
                        padding: 1.5rem;
                        border-bottom: 1px solid rgba(239, 68, 68, 0.2);
                    }
                    .velvz-delete-modal__icon {
                        width: 48px;
                        height: 48px;
                        background: linear-gradient(135deg, #ef4444, #dc2626);
                        border-radius: 12px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        font-size: 1.5rem;
                        flex-shrink: 0;
                    }
                    .velvz-delete-modal__title {
                        flex: 1;
                        font-size: 1.25rem;
                        font-weight: 600;
                        color: #fff;
                        margin: 0;
                    }
                    .velvz-delete-modal__close {
                        width: 36px;
                        height: 36px;
                        background: transparent;
                        border: 1px solid rgba(255,255,255,0.1);
                        border-radius: 8px;
                        color: rgba(255,255,255,0.5);
                        cursor: pointer;
                        transition: all 0.3s ease;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                    }
                    .velvz-delete-modal__close:hover {
                        background: rgba(255,255,255,0.1);
                        color: #fff;
                    }
                    .velvz-delete-modal__body {
                        padding: 1.5rem;
                    }
                    .velvz-delete-modal__warning {
                        background: rgba(239, 68, 68, 0.05);
                        border: 1px solid rgba(239, 68, 68, 0.2);
                        border-radius: 12px;
                        padding: 1rem;
                        margin-bottom: 1.5rem;
                    }
                    .velvz-delete-modal__process-name {
                        font-size: 1.1rem;
                        color: #fff;
                        margin: 0 0 0.75rem 0;
                    }
                    .velvz-delete-modal__process-name strong {
                        color: #ef4444;
                    }
                    .velvz-delete-modal__description {
                        color: rgba(255,255,255,0.6);
                        margin: 0;
                        line-height: 1.5;
                    }
                    .velvz-delete-modal__confirm-section {
                        display: flex;
                        flex-direction: column;
                        gap: 0.75rem;
                    }
                    .velvz-delete-modal__label {
                        color: #fff;
                        font-size: 0.95rem;
                    }
                    .velvz-delete-modal__input {
                        background: #16213e;
                        border: 2px solid rgba(255,255,255,0.1);
                        border-radius: 8px;
                        padding: 0.75rem 1rem;
                        color: #fff;
                        font-size: 1rem;
                        font-family: inherit;
                        transition: all 0.3s ease;
                    }
                    .velvz-delete-modal__input:focus {
                        outline: none;
                        border-color: rgba(239, 68, 68, 0.5);
                        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
                    }
                    .velvz-delete-modal__input--valid {
                        border-color: #10b981 !important;
                    }
                    .velvz-delete-modal__hint {
                        color: rgba(255,255,255,0.5);
                        font-size: 0.85rem;
                        min-height: 1.2rem;
                    }
                    .velvz-delete-modal__footer {
                        display: flex;
                        gap: 1rem;
                        padding: 1.5rem;
                        border-top: 1px solid rgba(255,255,255,0.1);
                        justify-content: flex-end;
                    }
                    .velvz-delete-modal__btn {
                        padding: 0.75rem 1.5rem;
                        border-radius: 10px;
                        font-weight: 500;
                        font-size: 0.95rem;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        border: none;
                        font-family: inherit;
                        display: flex;
                        align-items: center;
                        gap: 0.5rem;
                    }
                    .velvz-delete-modal__btn--cancel {
                        background: rgba(255,255,255,0.1);
                        color: #fff;
                        border: 1px solid rgba(255,255,255,0.1);
                    }
                    .velvz-delete-modal__btn--cancel:hover {
                        background: rgba(255,255,255,0.15);
                    }
                    .velvz-delete-modal__btn--delete {
                        background: linear-gradient(135deg, #ef4444, #dc2626);
                        color: white;
                    }
                    .velvz-delete-modal__btn--delete:hover:not(:disabled) {
                        background: linear-gradient(135deg, #dc2626, #b91c1c);
                        transform: translateY(-2px);
                        box-shadow: 0 4px 16px rgba(239, 68, 68, 0.3);
                    }
                    .velvz-delete-modal__btn--delete:disabled {
                        background: rgba(255,255,255,0.1);
                        color: rgba(255,255,255,0.3);
                        cursor: not-allowed;
                    }
                    @keyframes modalFadeIn {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }
                    @keyframes modalSlideUp {
                        from { opacity: 0; transform: translateY(20px); }
                        to { opacity: 1; transform: translateY(0); }
                    }

                    /* Loading overlay */
                    .velvz-loading-overlay {
                        position: fixed;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background: rgba(0, 0, 0, 0.9);
                        backdrop-filter: blur(10px);
                        z-index: 10001;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        flex-direction: column;
                        gap: 1.5rem;
                    }
                    .velvz-loading-overlay__spinner {
                        width: 60px;
                        height: 60px;
                        border: 4px solid rgba(16, 185, 129, 0.2);
                        border-top-color: #10b981;
                        border-radius: 50%;
                        animation: spin 1s linear infinite;
                    }
                    .velvz-loading-overlay__text {
                        color: #fff;
                        font-size: 1.25rem;
                        font-weight: 500;
                    }
                    .velvz-loading-overlay__subtext {
                        color: rgba(255,255,255,0.6);
                        font-size: 0.95rem;
                    }
                    @keyframes spin {
                        to { transform: rotate(360deg); }
                    }
                `;
                document.head.appendChild(styles);
            }

            return modal;
        }

        function showDeleteProcessModal() {
            const modal = createDeleteProcessModal();
            const input = document.getElementById('deleteConfirmInput');
            const confirmBtn = document.getElementById('deleteModalConfirm');
            const cancelBtn = document.getElementById('deleteModalCancel');
            const closeBtn = document.getElementById('deleteModalClose');
            const nameEl = document.getElementById('processNameToDelete');
            const hintEl = document.getElementById('deleteHint');

            // Establecer nombre del proceso
            const processName = document.getElementById('processName')?.value || 'Este proceso';
            if (nameEl) nameEl.textContent = processName;

            // Limpiar estado
            input.value = '';
            confirmBtn.disabled = true;
            hintEl.textContent = '';
            input.classList.remove('velvz-delete-modal__input--valid');

            // Mostrar modal
            modal.classList.add('velvz-delete-modal--open');
            document.body.style.overflow = 'hidden';

            setTimeout(() => input.focus(), 100);

            // Validación en tiempo real
            const inputHandler = function() {
                const value = this.value.trim().toUpperCase();
                if (value === 'ELIMINAR') {
                    confirmBtn.disabled = false;
                    hintEl.textContent = '✅ Correcto. Puedes proceder con la eliminación.';
                    hintEl.style.color = '#10b981';
                    this.classList.add('velvz-delete-modal__input--valid');
                } else if (value.length > 0) {
                    confirmBtn.disabled = true;
                    hintEl.textContent = '❌ Escribe exactamente: ELIMINAR';
                    hintEl.style.color = '#ef4444';
                    this.classList.remove('velvz-delete-modal__input--valid');
                } else {
                    confirmBtn.disabled = true;
                    hintEl.textContent = '';
                    this.classList.remove('velvz-delete-modal__input--valid');
                }
            };
            input.addEventListener('input', inputHandler);

            // Cerrar modal
            const closeModal = () => {
                modal.classList.remove('velvz-delete-modal--open');
                document.body.style.overflow = '';
                input.removeEventListener('input', inputHandler);
            };

            cancelBtn.onclick = closeModal;
            closeBtn.onclick = closeModal;
            modal.querySelector('.velvz-delete-modal__backdrop').onclick = closeModal;

            // ESC para cerrar
            const escHandler = (e) => {
                if (e.key === 'Escape') {
                    closeModal();
                    document.removeEventListener('keydown', escHandler);
                }
            };
            document.addEventListener('keydown', escHandler);

            // Confirmar eliminación
            confirmBtn.onclick = async function() {
                if (this.disabled) return;
                closeModal();
                await deleteProcessWithLoading();
            };
        }

        async function deleteProcessWithLoading() {
            // Desactivar beforeunload
            hasUnsavedChanges = false;

            // Mostrar loading overlay
            const loadingOverlay = document.createElement('div');
            loadingOverlay.className = 'velvz-loading-overlay';
            loadingOverlay.innerHTML = `
                <div class="velvz-loading-overlay__spinner"></div>
                <div class="velvz-loading-overlay__text">Eliminando proceso...</div>
                <div class="velvz-loading-overlay__subtext">Limpiando todos los datos asociados</div>
            `;
            document.body.appendChild(loadingOverlay);

            try {
                const token = window.velvzAuth?.getToken();
                if (!token) {
                    document.body.removeChild(loadingOverlay);
                    showToast('Tu sesión ha expirado', true);
                    window.location.href = '/auth/login.html';
                    return;
                }

                const response = await fetch(`${API_URL}/api/rrhh/processes/${currentProcessId}?force=true`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const result = await response.json();

                if (result.success) {
                    loadingOverlay.innerHTML = `
                        <div style="width: 60px; height: 60px; border-radius: 50%; background: #10b981; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-check" style="font-size: 1.5rem; color: white;"></i>
                        </div>
                        <div class="velvz-loading-overlay__text">¡Proceso eliminado!</div>
                        <div class="velvz-loading-overlay__subtext">Redirigiendo...</div>
                    `;

                    setTimeout(() => {
                        window.location.href = '/app/rrhh/processes/';
                    }, 1500);
                } else {
                    throw new Error(result.message || 'Error al eliminar el proceso');
                }
            } catch (error) {
                console.error('Error eliminando proceso:', error);
                document.body.removeChild(loadingOverlay);
                showToast('Error al eliminar: ' + error.message, true);

                // Restaurar checkbox
                const confirmCheckbox = document.getElementById('dangerConfirmCheckbox');
                if (confirmCheckbox) confirmCheckbox.checked = false;
                const deleteBtn = document.getElementById('dangerDeleteBtn');
                if (deleteBtn) deleteBtn.disabled = true;
            }
        }

        // Inicializar
        if (processId) {
            loadProcess(processId).then(() => {
                initDangerZone();
                initChangeDetection();
            });
        } else {
            // Cargar perfiles al iniciar (nuevo proceso)
            loadProfiles();
            initChangeDetection();
        }

        // =====================================================
        // MODAL EDITOR SIMPLIFICADO DE PERFIL
        // =====================================================
        (function() {
            const overlay = document.getElementById('profileAdjustOverlay');
            const backdrop = document.getElementById('profileAdjustBackdrop');
            const closeBtn = document.getElementById('profileAdjustClose');
            const cancelBtn = document.getElementById('adjustCancelBtn');
            const saveBtn = document.getElementById('adjustSaveBtn');
            const resetBtn = document.getElementById('adjustResetBtn');
            const adjustBtn = document.getElementById('adjustProfileBtn');
            const requirementsList = document.getElementById('adjustRequirementsList');
            const extrasContainer = document.getElementById('adjustExtras');
            const extrasList = document.getElementById('adjustExtrasList');
            const newReqInput = document.getElementById('adjustNewRequirement');
            const addReqBtn = document.getElementById('adjustAddReqBtn');
            const profileNameEl = document.getElementById('adjustModalProfileName');

            // Estado de ajustes
            let profileAdjustments = {
                excludedRequirements: [],
                extraRequirements: [],
                salaryMin: null,
                salaryMax: null,
                experience: null,
                modality: null
            };

            // Obtener datos del perfil seleccionado
            function getProfileData() {
                if (!selectedProfile) {
                    return {
                        title: 'Sin perfil seleccionado',
                        requirements: [],
                        salaryMin: null,
                        salaryMax: null,
                        experience: 0,
                        modality: 'hybrid'
                    };
                }

                const requirements = typeof selectedProfile.requirements === 'string'
                    ? JSON.parse(selectedProfile.requirements)
                    : selectedProfile.requirements || {};

                const allReqs = [];
                let id = 1;
                (requirements.essential || []).forEach(r => allReqs.push({ id: id++, name: r, type: 'essential' }));
                (requirements.desired || []).forEach(r => allReqs.push({ id: id++, name: r, type: 'desired' }));
                (requirements.niceToHave || []).forEach(r => allReqs.push({ id: id++, name: r, type: 'nice' }));

                return {
                    title: selectedProfile.name,
                    requirements: allReqs,
                    salaryMin: selectedProfile.salary_min,
                    salaryMax: selectedProfile.salary_max,
                    experience: selectedProfile.min_experience_years || 0,
                    modality: selectedProfile.modality || 'hybrid'
                };
            }

            // Abrir modal
            function openModal() {
                if (!selectedProfile) {
                    alert('Por favor, selecciona un perfil primero');
                    return;
                }
                const profileData = getProfileData();
                profileNameEl.textContent = profileData.title;
                renderRequirements();
                renderExtras();
                loadConditions();
                overlay.classList.add('profile-adjust-overlay--active');
                document.body.style.overflow = 'hidden';
            }

            // Cerrar modal
            function closeModal() {
                overlay.classList.remove('profile-adjust-overlay--active');
                document.body.style.overflow = '';
            }

            // Renderizar requisitos
            function renderRequirements() {
                const profileData = getProfileData();
                const typeLabels = {
                    essential: 'Esencial',
                    desired: 'Deseable',
                    nice: 'Valorable'
                };

                if (profileData.requirements.length === 0) {
                    requirementsList.innerHTML = '<p style="color: rgba(255,255,255,0.5); text-align: center; padding: 1rem;">Este perfil no tiene requisitos definidos</p>';
                    return;
                }

                requirementsList.innerHTML = profileData.requirements.map(req => {
                    const isExcluded = profileAdjustments.excludedRequirements.includes(req.id);
                    return `
                        <div class="adjust-requirement ${isExcluded ? 'adjust-requirement--excluded' : ''}" data-id="${req.id}">
                            <input type="checkbox" class="adjust-requirement__checkbox"
                                   ${!isExcluded ? 'checked' : ''}
                                   data-req-id="${req.id}">
                            <div class="adjust-requirement__info">
                                <div class="adjust-requirement__name">${req.name}</div>
                                <div class="adjust-requirement__type">Del perfil original</div>
                            </div>
                            <span class="adjust-requirement__badge adjust-requirement__badge--${req.type}">${typeLabels[req.type]}</span>
                        </div>
                    `;
                }).join('');

                // Event listeners para checkboxes
                requirementsList.querySelectorAll('.adjust-requirement__checkbox').forEach(cb => {
                    cb.addEventListener('change', function() {
                        const reqId = parseInt(this.dataset.reqId);
                        const reqEl = this.closest('.adjust-requirement');

                        if (this.checked) {
                            profileAdjustments.excludedRequirements = profileAdjustments.excludedRequirements.filter(id => id !== reqId);
                            reqEl.classList.remove('adjust-requirement--excluded');
                        } else {
                            if (!profileAdjustments.excludedRequirements.includes(reqId)) {
                                profileAdjustments.excludedRequirements.push(reqId);
                            }
                            reqEl.classList.add('adjust-requirement--excluded');
                        }
                    });
                });
            }

            // Renderizar requisitos extras
            function renderExtras() {
                if (profileAdjustments.extraRequirements.length === 0) {
                    extrasContainer.style.display = 'none';
                    return;
                }

                extrasContainer.style.display = 'block';
                extrasList.innerHTML = profileAdjustments.extraRequirements.map((req, index) => `
                    <div class="adjust-extra-item" data-index="${index}">
                        <span>${req}</span>
                        <button type="button" class="adjust-extra-remove" data-index="${index}">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `).join('');

                // Event listeners para eliminar
                extrasList.querySelectorAll('.adjust-extra-remove').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        profileAdjustments.extraRequirements.splice(index, 1);
                        renderExtras();
                    });
                });
            }

            // Cargar condiciones actuales
            function loadConditions() {
                const profileData = getProfileData();
                document.getElementById('adjustSalaryMin').value = profileAdjustments.salaryMin || '';
                document.getElementById('adjustSalaryMax').value = profileAdjustments.salaryMax || '';
                document.getElementById('adjustExperience').value = profileAdjustments.experience || '';
                document.getElementById('adjustModality').value = profileAdjustments.modality || '';

                // Placeholders con valores del perfil
                document.getElementById('adjustSalaryMin').placeholder = profileData.salaryMin ? `${profileData.salaryMin}€ (perfil)` : 'Sin especificar';
                document.getElementById('adjustSalaryMax').placeholder = profileData.salaryMax ? `${profileData.salaryMax}€ (perfil)` : 'Sin especificar';
                document.getElementById('adjustExperience').placeholder = profileData.experience ? `${profileData.experience} años (perfil)` : 'Sin especificar';
            }

            // Añadir requisito extra
            function addExtraRequirement() {
                const value = newReqInput.value.trim();
                if (value) {
                    profileAdjustments.extraRequirements.push(value);
                    newReqInput.value = '';
                    renderExtras();
                }
            }

            // Guardar ajustes
            function saveAdjustments() {
                // Guardar valores de condiciones
                const salaryMin = document.getElementById('adjustSalaryMin').value;
                const salaryMax = document.getElementById('adjustSalaryMax').value;
                const experience = document.getElementById('adjustExperience').value;
                const modality = document.getElementById('adjustModality').value;

                profileAdjustments.salaryMin = salaryMin ? parseInt(salaryMin) : null;
                profileAdjustments.salaryMax = salaryMax ? parseInt(salaryMax) : null;
                profileAdjustments.experience = experience ? parseInt(experience) : null;
                profileAdjustments.modality = modality || null;

                // Mostrar badge de modificado si hay cambios
                updateModifiedBadge();

                closeModal();
                console.log('Ajustes guardados:', profileAdjustments);
            }

            // Resetear ajustes
            function resetAdjustments() {
                profileAdjustments = {
                    excludedRequirements: [],
                    extraRequirements: [],
                    salaryMin: null,
                    salaryMax: null,
                    experience: null,
                    modality: null
                };
                renderRequirements();
                renderExtras();
                loadConditions();
            }

            // Mostrar/ocultar badge de modificado
            function updateModifiedBadge() {
                const preview = document.getElementById('profilePreview');
                const header = preview.querySelector('.profile-preview__header');
                let badge = header.querySelector('.profile-preview__modified');

                const hasChanges =
                    profileAdjustments.excludedRequirements.length > 0 ||
                    profileAdjustments.extraRequirements.length > 0 ||
                    profileAdjustments.salaryMin !== null ||
                    profileAdjustments.salaryMax !== null ||
                    profileAdjustments.experience !== null ||
                    profileAdjustments.modality !== null;

                if (hasChanges && !badge) {
                    badge = document.createElement('span');
                    badge.className = 'profile-preview__modified';
                    badge.innerHTML = '<i class="fas fa-pen"></i> Ajustado';
                    header.querySelector('h3').after(badge);
                } else if (!hasChanges && badge) {
                    badge.remove();
                }
            }

            // Event listeners
            if (adjustBtn) adjustBtn.addEventListener('click', openModal);
            if (backdrop) backdrop.addEventListener('click', closeModal);
            if (closeBtn) closeBtn.addEventListener('click', closeModal);
            if (cancelBtn) cancelBtn.addEventListener('click', closeModal);
            if (saveBtn) saveBtn.addEventListener('click', saveAdjustments);
            if (resetBtn) resetBtn.addEventListener('click', resetAdjustments);
            if (addReqBtn) addReqBtn.addEventListener('click', addExtraRequirement);
            if (newReqInput) {
                newReqInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        addExtraRequirement();
                    }
                });
            }

            // Cerrar con ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && overlay.classList.contains('profile-adjust-overlay--active')) {
                    closeModal();
                }
            });

            // Exponer para debugging
            window.profileAdjustModal = {
                open: openModal,
                close: closeModal,
                getAdjustments: () => profileAdjustments
            };
        })();
    </script>
</body>
</html>
