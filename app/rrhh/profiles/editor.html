<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de Perfil - RRHH IA - Velvz</title>

    <!-- Favicons -->
    <link rel="icon" href="/favicon.ico" sizes="48x48">
    <link rel="icon" href="/logoR.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/logoR.png">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/app-dashboard.css">
    <link rel="stylesheet" href="/assets/css/chatbot-config.css">
    <link rel="stylesheet" href="/assets/css/rrhh-process-editor.css">

    <!-- Auth System -->
    <script src="/assets/js/auth-config.js"></script>

    <style>
        :root {
            --rrhh-primary: #10b981;
            --rrhh-primary-light: rgba(16, 185, 129, 0.1);
            --rrhh-primary-glow: rgba(16, 185, 129, 0.3);
            --rrhh-primary-dark: #059669;
        }

        /* Override sidebar: solo activo verde */
        .velvz-sidebar__link--active {
            background: rgba(16, 185, 129, 0.15) !important;
            color: #10b981 !important;
        }
        .velvz-sidebar__link--active .velvz-sidebar__icon {
            color: #10b981 !important;
        }

        /* Tags para requisitos */
        .requirements-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .requirement-tag {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            font-size: 0.85rem;
            color: #fff;
        }

        .requirement-tag--essential {
            background: rgba(16, 185, 129, 0.15);
            border-color: rgba(16, 185, 129, 0.3);
            color: #34d399;
        }

        .requirement-tag--desired {
            background: rgba(245, 158, 11, 0.15);
            border-color: rgba(245, 158, 11, 0.3);
            color: #fbbf24;
        }

        .requirement-tag--nice {
            background: rgba(139, 92, 246, 0.15);
            border-color: rgba(139, 92, 246, 0.3);
            color: #a78bfa;
        }

        .requirement-tag__remove {
            background: none;
            border: none;
            color: rgba(255,255,255,0.4);
            cursor: pointer;
            padding: 0;
            font-size: 0.75rem;
            transition: color 0.2s;
        }

        .requirement-tag__remove:hover {
            color: #ef4444;
        }

        /* Input para añadir requisitos */
        .add-requirement-row {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .add-requirement-row .form-input {
            flex: 1;
        }

        .add-requirement-row .btn {
            flex-shrink: 0;
        }

        /* Idiomas list */
        .language-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 10px;
            margin-bottom: 0.5rem;
        }

        .language-item .form-select-wrapper {
            flex: 1;
        }

        .language-item__remove {
            background: none;
            border: none;
            color: rgba(255,255,255,0.3);
            cursor: pointer;
            padding: 0.5rem;
            font-size: 0.85rem;
            transition: color 0.2s;
        }

        .language-item__remove:hover {
            color: #ef4444;
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header class="velvz-header">
        <div class="velvz-header__container">
            <!-- LOGO -->
            <div class="velvz-header__island velvz-header__island--brand">
                <a href="/app/" class="velvz-header__logo">
                    <div class="velvz-header__logo-shape">
                        <div class="velvz-header__logo-face">
                            <div class="velvz-header__logo-eye"></div>
                            <div class="velvz-header__logo-mouth"></div>
                            <div class="velvz-header__logo-eye"></div>
                        </div>
                    </div>
                </a>
            </div>

            <!-- SELECTOR DE SERVICIOS -->
            <div class="velvz-header__island velvz-header__island--services">
                <button class="svc-selector" id="svcSelector" data-current="rrhh">
                    <i class="fas fa-users svc-selector__icon" style="color: #10b981;"></i>
                    <span class="svc-selector__text">RRHH</span>
                    <i class="fas fa-chevron-down svc-selector__arrow"></i>
                </button>
                <div class="svc-dropdown" id="svcDropdown">
                    <a href="/app/chatbots/dashboard.html" class="svc-dropdown__item" data-service="chatbots">
                        <i class="fas fa-robot"></i>
                        <span>Chatbots</span>
                    </a>
                    <a href="/app/rrhh/" class="svc-dropdown__item svc-dropdown__item--active" data-service="rrhh">
                        <i class="fas fa-users"></i>
                        <span>RRHH</span>
                    </a>
                </div>
            </div>

            <!-- BUSQUEDA -->
            <div class="velvz-header__island velvz-header__island--search">
                <div class="velvz-header__search">
                    <input type="text" class="velvz-header__search-input" placeholder="Buscar..." id="headerSearchInput">
                    <i class="fas fa-search velvz-header__search-icon"></i>
                </div>
            </div>

            <!-- PERFIL -->
            <div class="velvz-header__island velvz-header__island--cta">
                <div class="velvz-header__avatar" id="userAvatar">
                    <div class="velvz-header__avatar-circle">
                        <span id="userInitials">-</span>
                    </div>
                </div>
            </div>

            <!-- TOGGLE MOVIL -->
            <div class="velvz-header__mobile-toggle" id="mobileMenuToggle">
                <div class="velvz-header__hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
    </header>

    <!-- LAYOUT PRINCIPAL -->
    <div class="velvz-app">
        <!-- SIDEBAR -->
        <aside class="velvz-sidebar">
            <div class="velvz-sidebar__section">
                <h3 class="velvz-sidebar__title">RRHH IA</h3>
                <ul class="velvz-sidebar__menu">
                    <li class="velvz-sidebar__item">
                        <a href="/app/rrhh/" class="velvz-sidebar__link">
                            <i class="velvz-sidebar__icon fas fa-th-large"></i>
                            <span>Panel Principal</span>
                        </a>
                    </li>
                </ul>
            </div>

            <div class="velvz-sidebar__section">
                <h3 class="velvz-sidebar__title">Gestión</h3>
                <ul class="velvz-sidebar__menu">
                    <li class="velvz-sidebar__item">
                        <a href="/app/rrhh/processes/" class="velvz-sidebar__link">
                            <i class="velvz-sidebar__icon fas fa-briefcase"></i>
                            <span>Procesos</span>
                        </a>
                    </li>
                    <li class="velvz-sidebar__item">
                        <a href="/app/rrhh/candidates/" class="velvz-sidebar__link">
                            <i class="velvz-sidebar__icon fas fa-user-tie"></i>
                            <span>Candidatos</span>
                        </a>
                    </li>
                    <li class="velvz-sidebar__item">
                        <a href="/app/rrhh/profiles/" class="velvz-sidebar__link velvz-sidebar__link--active">
                            <i class="velvz-sidebar__icon fas fa-id-badge"></i>
                            <span>Perfiles</span>
                        </a>
                    </li>
                </ul>
            </div>

            <div class="velvz-sidebar__section">
                <h3 class="velvz-sidebar__title">Ajustes</h3>
                <ul class="velvz-sidebar__menu">
                    <li class="velvz-sidebar__item">
                        <a href="/app/plans/" class="velvz-sidebar__link">
                            <i class="velvz-sidebar__icon fas fa-gem"></i>
                            <span>Planes</span>
                        </a>
                    </li>
                    <li class="velvz-sidebar__item">
                        <a href="/app/settings/" class="velvz-sidebar__link">
                            <i class="velvz-sidebar__icon fas fa-cog"></i>
                            <span>Configuración</span>
                        </a>
                    </li>
                </ul>
            </div>
        </aside>

        <!-- MAIN -->
        <main class="velvz-main">
            <div class="process-editor">
                <!-- HEADER DEL EDITOR -->
                <div class="process-editor__header">
                    <!-- Breadcrumbs -->
                    <nav class="velvz-breadcrumbs">
                        <a href="/app/rrhh/" class="velvz-breadcrumbs__link">
                            <i class="fas fa-users" style="margin-right: 0.35rem;"></i>RRHH
                        </a>
                        <span class="velvz-breadcrumbs__separator">
                            <i class="fas fa-chevron-right"></i>
                        </span>
                        <a href="/app/rrhh/profiles/" class="velvz-breadcrumbs__link">Perfiles</a>
                        <span class="velvz-breadcrumbs__separator">
                            <i class="fas fa-chevron-right"></i>
                        </span>
                        <span class="velvz-breadcrumbs__current" id="breadcrumbTitle">Nuevo Perfil</span>
                    </nav>

                    <!-- Titulo y acciones -->
                    <div class="process-editor__title-row">
                        <div class="process-editor__title-group">
                            <h1 class="process-editor__title" id="profileTitle">Nuevo Perfil de Puesto</h1>
                        </div>
                        <div class="process-editor__actions">
                            <button class="btn btn--secondary" id="cancelBtn">
                                <i class="fas fa-times"></i>
                                <span>Cancelar</span>
                            </button>
                            <button class="btn btn--primary" id="saveBtn">
                                <i class="fas fa-save"></i>
                                <span>Guardar Perfil</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- NAVEGACIÓN DE SECCIONES -->
                <div class="velvz-config__tabs">
                    <div class="velvz-config__tabs-nav">
                        <button class="velvz-config__tab velvz-config__tab--active" data-tab="basic">
                            <i class="fas fa-info-circle"></i>
                            <span>Información Básica</span>
                        </button>
                        <button class="velvz-config__tab" data-tab="requirements">
                            <i class="fas fa-list-check"></i>
                            <span>Requisitos</span>
                        </button>
                        <button class="velvz-config__tab" data-tab="filtering">
                            <i class="fas fa-filter"></i>
                            <span>Filtrado IA</span>
                        </button>
                        <button class="velvz-config__tab" data-tab="interview">
                            <i class="fas fa-robot"></i>
                            <span>Entrevista IA</span>
                        </button>
                        <button class="velvz-config__tab" data-tab="documents">
                            <i class="fas fa-folder"></i>
                            <span>Documentos</span>
                        </button>
                    </div>
                </div>

                <!-- CONTENIDO DE LAS SECCIONES -->
                <div class="process-editor__content">

                    <!-- ===== SECCIÓN 1: INFORMACIÓN BÁSICA ===== -->
                    <section class="process-section process-section--active" data-tab="basic">
                        <div class="section-panel">
                            <div class="section-panel__header">
                                <div class="section-panel__icon">
                                    <i class="fas fa-info-circle"></i>
                                </div>
                                <div class="section-panel__title">
                                    <h2>Información del Puesto</h2>
                                    <p>Define los datos generales del perfil de puesto</p>
                                </div>
                            </div>

                            <div class="section-panel__body">
                                <!-- Nombre del puesto -->
                                <div class="form-field">
                                    <label class="form-label">
                                        Nombre del Puesto
                                        <span class="form-required">*</span>
                                    </label>
                                    <input type="text" class="form-input" id="profileName" placeholder="Ej: Desarrollador Frontend Senior">
                                    <span class="form-hint">Este nombre será único en tu empresa</span>
                                </div>

                                <!-- Grid 2 columnas -->
                                <div class="form-grid form-grid--2">
                                    <div class="form-field">
                                        <label class="form-label">
                                            Departamento
                                            <span class="form-required">*</span>
                                        </label>
                                        <div class="form-select-wrapper">
                                            <select class="form-select" id="departmentSelect">
                                                <option value="">Seleccionar...</option>
                                                <option value="tech">Tecnología</option>
                                                <option value="product">Producto</option>
                                                <option value="design">Diseño</option>
                                                <option value="sales">Ventas</option>
                                                <option value="marketing">Marketing</option>
                                                <option value="hr">Recursos Humanos</option>
                                                <option value="finance">Finanzas</option>
                                                <option value="operations">Operaciones</option>
                                                <option value="other">Otro</option>
                                            </select>
                                            <i class="fas fa-chevron-down form-select-icon"></i>
                                        </div>
                                    </div>

                                    <div class="form-field">
                                        <label class="form-label">
                                            Ubicación
                                            <span class="form-required">*</span>
                                        </label>
                                        <input type="text" class="form-input" id="locationInput" placeholder="Ej: Madrid, Barcelona, Remoto...">
                                    </div>
                                </div>

                                <!-- Modalidad -->
                                <div class="form-field">
                                    <label class="form-label">
                                        Modalidad de Trabajo
                                        <span class="form-required">*</span>
                                    </label>
                                    <div class="interview-types">
                                        <label class="interview-type interview-type--selected">
                                            <input type="radio" name="modality" value="onsite">
                                            <div class="interview-type__content">
                                                <i class="fas fa-building"></i>
                                                <span class="interview-type__title">Presencial</span>
                                                <span class="interview-type__desc">100% en oficina</span>
                                            </div>
                                        </label>
                                        <label class="interview-type">
                                            <input type="radio" name="modality" value="hybrid" checked>
                                            <div class="interview-type__content">
                                                <i class="fas fa-laptop-house"></i>
                                                <span class="interview-type__title">Híbrido</span>
                                                <span class="interview-type__desc">Oficina + remoto</span>
                                            </div>
                                        </label>
                                        <label class="interview-type">
                                            <input type="radio" name="modality" value="remote">
                                            <div class="interview-type__content">
                                                <i class="fas fa-home"></i>
                                                <span class="interview-type__title">Remoto</span>
                                                <span class="interview-type__desc">100% teletrabajo</span>
                                            </div>
                                        </label>
                                    </div>
                                </div>

                                <!-- Descripción -->
                                <div class="form-field">
                                    <label class="form-label">
                                        Descripción del Puesto
                                        <span class="form-required">*</span>
                                    </label>
                                    <textarea class="form-textarea" id="jobDescription" rows="4" placeholder="Describe el puesto, responsabilidades principales, el equipo con el que trabajará..."></textarea>
                                    <div class="form-field__footer">
                                        <span class="form-hint">Esta descripción se mostrará a los candidatos</span>
                                        <span class="form-counter"><span id="descriptionCount">0</span>/2000</span>
                                    </div>
                                </div>

                                <!-- Rango salarial -->
                                <div class="form-field">
                                    <label class="form-label">Rango Salarial</label>
                                    <div class="salary-range">
                                        <div class="salary-range__input">
                                            <span class="salary-range__currency">€</span>
                                            <input type="number" class="form-input" id="salaryMin" placeholder="Mínimo">
                                        </div>
                                        <span class="salary-range__separator">-</span>
                                        <div class="salary-range__input">
                                            <span class="salary-range__currency">€</span>
                                            <input type="number" class="form-input" id="salaryMax" placeholder="Máximo">
                                        </div>
                                        <div class="form-select-wrapper salary-range__period">
                                            <select class="form-select" id="salaryPeriod">
                                                <option value="year">/ año</option>
                                                <option value="month">/ mes</option>
                                            </select>
                                            <i class="fas fa-chevron-down form-select-icon"></i>
                                        </div>
                                    </div>
                                    <label class="toggle-option" style="margin-top: 0.75rem;">
                                        <input type="checkbox" id="salaryVisible" checked>
                                        <span class="toggle-option__slider"></span>
                                        <div class="toggle-option__content">
                                            <span class="toggle-option__label">Mostrar salario en la oferta pública</span>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Navegación -->
                        <div class="section-nav">
                            <div></div>
                            <button class="btn btn--primary btn--next" data-next="requirements">
                                Siguiente: Requisitos
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </section>

                    <!-- ===== SECCIÓN 2: REQUISITOS ===== -->
                    <section class="process-section" data-tab="requirements">
                        <div class="section-panel">
                            <div class="section-panel__header">
                                <div class="section-panel__icon">
                                    <i class="fas fa-list-check"></i>
                                </div>
                                <div class="section-panel__title">
                                    <h2>Requisitos del Candidato</h2>
                                    <p>Define qué necesitas del candidato ideal. Estos criterios se usarán para el filtrado automático.</p>
                                </div>
                            </div>

                            <div class="section-panel__body">
                                <!-- Experiencia mínima -->
                                <div class="form-field">
                                    <label class="form-label">
                                        Experiencia Mínima Requerida
                                        <span class="form-required">*</span>
                                    </label>
                                    <div class="form-select-wrapper" style="max-width: 200px;">
                                        <select class="form-select" id="minExperience">
                                            <option value="0">Sin experiencia</option>
                                            <option value="1">1+ año</option>
                                            <option value="2">2+ años</option>
                                            <option value="3" selected>3+ años</option>
                                            <option value="5">5+ años</option>
                                            <option value="7">7+ años</option>
                                            <option value="10">10+ años</option>
                                        </select>
                                        <i class="fas fa-chevron-down form-select-icon"></i>
                                    </div>
                                </div>

                                <!-- Requisitos Esenciales -->
                                <div class="requirements-block requirements-block--essential">
                                    <div class="requirements-block__header">
                                        <div class="requirements-block__icon">
                                            <i class="fas fa-check-circle"></i>
                                        </div>
                                        <div>
                                            <h3>Requisitos Esenciales</h3>
                                            <p>Sin estos requisitos, el candidato será descartado automáticamente</p>
                                        </div>
                                    </div>
                                    <div class="requirements-tags" id="essentialTags">
                                        <!-- Se añaden dinámicamente -->
                                    </div>
                                    <div class="add-requirement-row">
                                        <input type="text" class="form-input" id="essentialInput" placeholder="Escribe y pulsa Enter o el botón...">
                                        <button class="btn btn--secondary" id="addEssentialBtn">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- Requisitos Deseables -->
                                <div class="requirements-block requirements-block--desired">
                                    <div class="requirements-block__header">
                                        <div class="requirements-block__icon">
                                            <i class="fas fa-star"></i>
                                        </div>
                                        <div>
                                            <h3>Requisitos Deseables</h3>
                                            <p>Suman puntos en la evaluación, pero no son eliminatorios</p>
                                        </div>
                                    </div>
                                    <div class="requirements-tags" id="desiredTags">
                                        <!-- Se añaden dinámicamente -->
                                    </div>
                                    <div class="add-requirement-row">
                                        <input type="text" class="form-input" id="desiredInput" placeholder="Escribe y pulsa Enter o el botón...">
                                        <button class="btn btn--secondary" id="addDesiredBtn">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- Nice to Have -->
                                <div class="requirements-block requirements-block--nice">
                                    <div class="requirements-block__header">
                                        <div class="requirements-block__icon">
                                            <i class="fas fa-plus-circle"></i>
                                        </div>
                                        <div>
                                            <h3>Se Valorará (Nice to Have)</h3>
                                            <p>Características que serían un plus pero no se esperan</p>
                                        </div>
                                    </div>
                                    <div class="requirements-tags" id="niceTags">
                                        <!-- Se añaden dinámicamente -->
                                    </div>
                                    <div class="add-requirement-row">
                                        <input type="text" class="form-input" id="niceInput" placeholder="Escribe y pulsa Enter o el botón...">
                                        <button class="btn btn--secondary" id="addNiceBtn">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- Idiomas -->
                                <div class="form-field" style="margin-top: 2rem;">
                                    <label class="form-label">
                                        <i class="fas fa-globe" style="margin-right: 0.5rem; color: #3b82f6;"></i>
                                        Idiomas Requeridos
                                    </label>
                                    <div id="languagesList">
                                        <!-- Se añaden dinámicamente -->
                                    </div>
                                    <button class="btn btn--add-requirement" id="addLanguageBtn" style="margin-top: 0.5rem;">
                                        <i class="fas fa-plus"></i>
                                        Añadir idioma
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Navegación -->
                        <div class="section-nav">
                            <button class="btn btn--secondary btn--prev" data-prev="basic">
                                <i class="fas fa-arrow-left"></i>
                                Anterior
                            </button>
                            <button class="btn btn--primary btn--next" data-next="filtering">
                                Siguiente: Filtrado IA
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </section>

                    <!-- ===== SECCIÓN 3: FILTRADO IA ===== -->
                    <section class="process-section" data-tab="filtering">
                        <div class="section-panel">
                            <div class="section-panel__header">
                                <div class="section-panel__icon">
                                    <i class="fas fa-filter"></i>
                                </div>
                                <div class="section-panel__title">
                                    <h2>Configuración de Filtrado IA</h2>
                                    <p>Define cómo la IA evaluará y priorizará los candidatos</p>
                                </div>
                            </div>

                            <div class="section-panel__body">
                                <!-- Pesos de evaluación -->
                                <div class="filtering-card">
                                    <div class="filtering-card__header">
                                        <i class="fas fa-balance-scale"></i>
                                        <h3>Pesos de Evaluación</h3>
                                    </div>
                                    <div class="filtering-card__body">
                                        <p class="filtering-card__description">Ajusta la importancia de cada factor en la puntuación del candidato. El total debe sumar 100%.</p>

                                        <div class="weight-sliders">
                                            <div class="weight-slider">
                                                <div class="weight-slider__header">
                                                    <span class="weight-slider__label">Experiencia Relevante</span>
                                                    <span class="weight-slider__value" id="weightExpValue">30%</span>
                                                </div>
                                                <input type="range" class="weight-slider__input" id="weightExperience" min="0" max="100" value="30">
                                            </div>
                                            <div class="weight-slider">
                                                <div class="weight-slider__header">
                                                    <span class="weight-slider__label">Habilidades/Skills</span>
                                                    <span class="weight-slider__value" id="weightSkillsValue">40%</span>
                                                </div>
                                                <input type="range" class="weight-slider__input" id="weightSkills" min="0" max="100" value="40">
                                            </div>
                                            <div class="weight-slider">
                                                <div class="weight-slider__header">
                                                    <span class="weight-slider__label">Formación Académica</span>
                                                    <span class="weight-slider__value" id="weightEducationValue">15%</span>
                                                </div>
                                                <input type="range" class="weight-slider__input" id="weightEducation" min="0" max="100" value="15">
                                            </div>
                                            <div class="weight-slider">
                                                <div class="weight-slider__header">
                                                    <span class="weight-slider__label">Idiomas</span>
                                                    <span class="weight-slider__value" id="weightLanguagesValue">15%</span>
                                                </div>
                                                <input type="range" class="weight-slider__input" id="weightLanguages" min="0" max="100" value="15">
                                            </div>
                                        </div>

                                        <div class="weight-total">
                                            <span>Total:</span>
                                            <span id="weightTotal" class="weight-total__value">100%</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Límites -->
                                <div class="filtering-card">
                                    <div class="filtering-card__header">
                                        <i class="fas fa-users"></i>
                                        <h3>Límites de Candidatos</h3>
                                    </div>
                                    <div class="filtering-card__body">
                                        <div class="form-grid form-grid--2">
                                            <div class="form-field">
                                                <label class="form-label">Candidatos máximos a entrevista</label>
                                                <input type="number" class="form-input" id="maxCandidatesInterview" placeholder="20" value="20">
                                                <span class="form-hint">Número máximo de candidatos que pasarán a la fase de entrevista IA</span>
                                            </div>
                                            <div class="form-field">
                                                <label class="form-label">Puntuación mínima (%)</label>
                                                <input type="number" class="form-input" id="minScore" placeholder="40" value="40" min="0" max="100">
                                                <span class="form-hint">Candidatos por debajo de esta puntuación serán descartados automáticamente</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Navegación -->
                        <div class="section-nav">
                            <button class="btn btn--secondary btn--prev" data-prev="requirements">
                                <i class="fas fa-arrow-left"></i>
                                Anterior
                            </button>
                            <button class="btn btn--primary btn--next" data-next="interview">
                                Siguiente: Entrevista IA
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </section>

                    <!-- ===== SECCIÓN 4: ENTREVISTA IA ===== -->
                    <section class="process-section" data-tab="interview">
                        <div class="section-panel">
                            <div class="section-panel__header">
                                <div class="section-panel__icon">
                                    <i class="fas fa-robot"></i>
                                </div>
                                <div class="section-panel__title">
                                    <h2>Configuración de Entrevista IA</h2>
                                    <p>Define cómo la IA entrevistará a los candidatos para este perfil</p>
                                </div>
                            </div>

                            <div class="section-panel__body">
                                <!-- Tipo de entrevista -->
                                <div class="form-field">
                                    <label class="form-label">Tipo de Entrevista</label>
                                    <div class="interview-types">
                                        <label class="interview-type">
                                            <input type="radio" name="interviewType" value="technical">
                                            <div class="interview-type__content">
                                                <i class="fas fa-code"></i>
                                                <span class="interview-type__title">Técnica</span>
                                                <span class="interview-type__desc">Enfocada en skills técnicos</span>
                                            </div>
                                        </label>
                                        <label class="interview-type interview-type--selected">
                                            <input type="radio" name="interviewType" value="competency" checked>
                                            <div class="interview-type__content">
                                                <i class="fas fa-brain"></i>
                                                <span class="interview-type__title">Competencias</span>
                                                <span class="interview-type__desc">Soft skills y experiencia</span>
                                            </div>
                                        </label>
                                        <label class="interview-type">
                                            <input type="radio" name="interviewType" value="cultural">
                                            <div class="interview-type__content">
                                                <i class="fas fa-handshake"></i>
                                                <span class="interview-type__title">Cultural</span>
                                                <span class="interview-type__desc">Fit cultural y valores</span>
                                            </div>
                                        </label>
                                        <label class="interview-type">
                                            <input type="radio" name="interviewType" value="mixed">
                                            <div class="interview-type__content">
                                                <i class="fas fa-layer-group"></i>
                                                <span class="interview-type__title">Mixta</span>
                                                <span class="interview-type__desc">Combinación de todas</span>
                                            </div>
                                        </label>
                                    </div>
                                </div>

                                <!-- Duración -->
                                <div class="form-grid form-grid--2">
                                    <div class="form-field">
                                        <label class="form-label">Duración Estimada</label>
                                        <div class="form-select-wrapper">
                                            <select class="form-select" id="interviewDuration">
                                                <option value="15">15 minutos</option>
                                                <option value="20" selected>20 minutos</option>
                                                <option value="30">30 minutos</option>
                                                <option value="45">45 minutos</option>
                                            </select>
                                            <i class="fas fa-chevron-down form-select-icon"></i>
                                        </div>
                                    </div>
                                    <div class="form-field">
                                        <label class="form-label">Idioma Principal</label>
                                        <div class="form-select-wrapper">
                                            <select class="form-select" id="interviewLanguage">
                                                <option value="es" selected>Español</option>
                                                <option value="en">Inglés</option>
                                                <option value="auto">Detectar automáticamente</option>
                                            </select>
                                            <i class="fas fa-chevron-down form-select-icon"></i>
                                        </div>
                                    </div>
                                </div>

                                <!-- Aspectos a evaluar -->
                                <div class="form-field">
                                    <label class="form-label">Aspectos a Evaluar en la Entrevista</label>
                                    <div class="evaluation-aspects" id="evaluationAspects">
                                        <div class="evaluation-aspect">
                                            <input type="checkbox" id="aspectProblemSolving" checked>
                                            <label for="aspectProblemSolving">
                                                <i class="fas fa-lightbulb"></i>
                                                Resolución de Problemas
                                            </label>
                                        </div>
                                        <div class="evaluation-aspect">
                                            <input type="checkbox" id="aspectCommunication" checked>
                                            <label for="aspectCommunication">
                                                <i class="fas fa-comment-dots"></i>
                                                Comunicación
                                            </label>
                                        </div>
                                        <div class="evaluation-aspect">
                                            <input type="checkbox" id="aspectTeamwork" checked>
                                            <label for="aspectTeamwork">
                                                <i class="fas fa-users"></i>
                                                Trabajo en Equipo
                                            </label>
                                        </div>
                                        <div class="evaluation-aspect">
                                            <input type="checkbox" id="aspectTechnical" checked>
                                            <label for="aspectTechnical">
                                                <i class="fas fa-cogs"></i>
                                                Conocimiento Técnico
                                            </label>
                                        </div>
                                        <div class="evaluation-aspect">
                                            <input type="checkbox" id="aspectMotivation">
                                            <label for="aspectMotivation">
                                                <i class="fas fa-fire"></i>
                                                Motivación
                                            </label>
                                        </div>
                                        <div class="evaluation-aspect">
                                            <input type="checkbox" id="aspectLeadership">
                                            <label for="aspectLeadership">
                                                <i class="fas fa-crown"></i>
                                                Liderazgo
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Preguntas personalizadas -->
                                <div class="form-field">
                                    <label class="form-label">Preguntas Personalizadas (opcional)</label>
                                    <span class="form-hint" style="display: block; margin-bottom: 0.75rem;">Añade preguntas específicas que la IA debe hacer a los candidatos</span>
                                    <div id="customQuestions">
                                        <!-- Se añaden dinámicamente -->
                                    </div>
                                    <button class="btn btn--add-requirement" id="addQuestionBtn">
                                        <i class="fas fa-plus"></i>
                                        Añadir pregunta personalizada
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Navegación -->
                        <div class="section-nav">
                            <button class="btn btn--secondary btn--prev" data-prev="filtering">
                                <i class="fas fa-arrow-left"></i>
                                Anterior
                            </button>
                            <button class="btn btn--primary btn--next" data-next="documents">
                                Siguiente: Documentos
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </section>

                    <!-- ===== SECCIÓN 5: DOCUMENTOS ===== -->
                    <section class="process-section" data-tab="documents">
                        <div class="section-panel">
                            <div class="section-panel__header">
                                <div class="section-panel__icon">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <div class="section-panel__title">
                                    <h2>Documentos del Puesto</h2>
                                    <p>Sube documentos que describan el puesto o que la IA pueda usar como contexto</p>
                                </div>
                            </div>

                            <div class="section-panel__body">
                                <!-- Info -->
                                <div class="info-box">
                                    <div class="info-box__icon">
                                        <i class="fas fa-lightbulb"></i>
                                    </div>
                                    <div class="info-box__content">
                                        <h4>¿Para qué sirven estos documentos?</h4>
                                        <p>Puedes subir la descripción oficial del puesto (PDF), documentos de la empresa, o cualquier material que ayude a la IA a entender mejor el contexto del puesto y evaluar mejor a los candidatos.</p>
                                    </div>
                                </div>

                                <!-- Zona de subida -->
                                <div class="upload-zone" id="uploadZone">
                                    <div class="upload-zone__content">
                                        <div class="upload-zone__icon">
                                            <i class="fas fa-cloud-upload-alt"></i>
                                        </div>
                                        <h3>Arrastra documentos aquí</h3>
                                        <p>o haz clic para seleccionar archivos</p>
                                        <span class="upload-zone__hint">PDF, DOC, DOCX, TXT - Máx. 10MB por archivo</span>
                                    </div>
                                    <input type="file" id="fileInput" multiple accept=".pdf,.doc,.docx,.txt" hidden>
                                </div>

                                <!-- Lista de documentos -->
                                <div class="documents-list" id="documentsList">
                                    <!-- Se añaden dinámicamente -->
                                </div>
                            </div>
                        </div>

                        <!-- Acciones finales -->
                        <div class="section-panel">
                            <div class="section-panel__body">
                                <div class="summary-actions" style="justify-content: flex-end;">
                                    <button class="btn btn--secondary btn--large" id="cancelBtnFinal">
                                        <i class="fas fa-times"></i>
                                        Cancelar
                                    </button>
                                    <button class="btn btn--primary btn--large" id="saveBtnFinal">
                                        <i class="fas fa-save"></i>
                                        Guardar Perfil
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Navegación -->
                        <div class="section-nav">
                            <button class="btn btn--secondary btn--prev" data-prev="interview">
                                <i class="fas fa-arrow-left"></i>
                                Anterior
                            </button>
                            <div></div>
                        </div>
                    </section>

                </div>
            </div>
        </main>
    </div>

    <!-- FOOTER -->
    <footer class="velvz-footer">
        <div class="velvz-footer__container">
            <div class="velvz-footer__brand">
                <a href="/" class="velvz-footer__logo-link">
                    <div class="velvz-footer__logo">
                        <div class="velvz-footer__logo-shape">
                            <div class="velvz-footer__logo-face">
                                <div class="velvz-footer__logo-eye velvz-footer__logo-eye--left"></div>
                                <div class="velvz-footer__logo-mouth"></div>
                                <div class="velvz-footer__logo-eye velvz-footer__logo-eye--right"></div>
                            </div>
                        </div>
                    </div>
                    <span class="velvz-footer__brand-name">Velvz</span>
                </a>
                <p class="velvz-footer__tagline">IA conversacional para empresas</p>
            </div>

            <nav class="velvz-footer__links">
                <a href="/" class="velvz-footer__link">Inicio</a>
                <a href="/servicios/" class="velvz-footer__link">Servicios</a>
                <a href="/precios/" class="velvz-footer__link">Precios</a>
                <a href="/documentacion/" class="velvz-footer__link">Documentación</a>
                <a href="/contacto/" class="velvz-footer__link">Contacto</a>
            </nav>

            <div class="velvz-footer__legal">
                <div class="velvz-footer__copyright">© 2025 Velvz SL</div>
                <div>
                    <a href="/privacidad/" class="velvz-footer__link">Privacidad</a> ·
                    <a href="/terminos/" class="velvz-footer__link">Términos</a> ·
                    <a href="/cookies/" class="velvz-footer__link">Cookies</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="/assets/js/app-dashboard.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // =====================================================
            // Estado del perfil
            // =====================================================
            const profileData = {
                essential: [],
                desired: [],
                niceToHave: [],
                languages: [],
                customQuestions: [],
                documents: []
            };

            // =====================================================
            // Navegación de tabs
            // =====================================================
            const tabs = document.querySelectorAll('.velvz-config__tab');
            const sections = document.querySelectorAll('.process-section');

            function switchTab(tabId) {
                tabs.forEach(t => t.classList.remove('velvz-config__tab--active'));
                sections.forEach(s => s.classList.remove('process-section--active'));

                const activeTab = document.querySelector(`.velvz-config__tab[data-tab="${tabId}"]`);
                const activeSection = document.querySelector(`.process-section[data-tab="${tabId}"]`);

                if (activeTab) activeTab.classList.add('velvz-config__tab--active');
                if (activeSection) activeSection.classList.add('process-section--active');
            }

            tabs.forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab.dataset.tab));
            });

            // Botones siguiente/anterior
            document.querySelectorAll('.btn--next').forEach(btn => {
                btn.addEventListener('click', () => switchTab(btn.dataset.next));
            });

            document.querySelectorAll('.btn--prev').forEach(btn => {
                btn.addEventListener('click', () => switchTab(btn.dataset.prev));
            });

            // =====================================================
            // Requisitos (tags)
            // =====================================================
            function createTag(text, type) {
                const tag = document.createElement('span');
                tag.className = `requirement-tag requirement-tag--${type}`;
                tag.innerHTML = `
                    ${text}
                    <button class="requirement-tag__remove" data-text="${text}">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                return tag;
            }

            function renderTags(containerId, items, type) {
                const container = document.getElementById(containerId);
                container.innerHTML = '';
                items.forEach(item => {
                    const tag = createTag(item, type);
                    tag.querySelector('.requirement-tag__remove').addEventListener('click', () => {
                        const idx = items.indexOf(item);
                        if (idx > -1) items.splice(idx, 1);
                        renderTags(containerId, items, type);
                    });
                    container.appendChild(tag);
                });
            }

            function setupRequirementInput(inputId, btnId, containerId, array, type) {
                const input = document.getElementById(inputId);
                const btn = document.getElementById(btnId);

                const addItem = () => {
                    const text = input.value.trim();
                    if (text && !array.includes(text)) {
                        array.push(text);
                        renderTags(containerId, array, type);
                        input.value = '';
                    }
                };

                btn.addEventListener('click', addItem);
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        addItem();
                    }
                });
            }

            setupRequirementInput('essentialInput', 'addEssentialBtn', 'essentialTags', profileData.essential, 'essential');
            setupRequirementInput('desiredInput', 'addDesiredBtn', 'desiredTags', profileData.desired, 'desired');
            setupRequirementInput('niceInput', 'addNiceBtn', 'niceTags', profileData.niceToHave, 'nice');

            // =====================================================
            // Idiomas
            // =====================================================
            const languagesList = document.getElementById('languagesList');
            let languageIdCounter = 0;

            function addLanguage(lang = '', level = 'professional') {
                const id = languageIdCounter++;
                const item = document.createElement('div');
                item.className = 'language-item';
                item.dataset.id = id;
                item.innerHTML = `
                    <div class="form-select-wrapper">
                        <select class="form-select lang-select">
                            <option value="">Seleccionar idioma...</option>
                            <option value="es" ${lang === 'es' ? 'selected' : ''}>Español</option>
                            <option value="en" ${lang === 'en' ? 'selected' : ''}>Inglés</option>
                            <option value="fr" ${lang === 'fr' ? 'selected' : ''}>Francés</option>
                            <option value="de" ${lang === 'de' ? 'selected' : ''}>Alemán</option>
                            <option value="pt" ${lang === 'pt' ? 'selected' : ''}>Portugués</option>
                            <option value="it" ${lang === 'it' ? 'selected' : ''}>Italiano</option>
                            <option value="zh" ${lang === 'zh' ? 'selected' : ''}>Chino</option>
                            <option value="other" ${lang === 'other' ? 'selected' : ''}>Otro</option>
                        </select>
                        <i class="fas fa-chevron-down form-select-icon"></i>
                    </div>
                    <div class="form-select-wrapper">
                        <select class="form-select level-select">
                            <option value="native" ${level === 'native' ? 'selected' : ''}>Nativo</option>
                            <option value="professional" ${level === 'professional' ? 'selected' : ''}>Profesional (C1-C2)</option>
                            <option value="intermediate" ${level === 'intermediate' ? 'selected' : ''}>Intermedio (B1-B2)</option>
                            <option value="basic" ${level === 'basic' ? 'selected' : ''}>Básico (A1-A2)</option>
                        </select>
                        <i class="fas fa-chevron-down form-select-icon"></i>
                    </div>
                    <button class="language-item__remove" title="Eliminar">
                        <i class="fas fa-trash"></i>
                    </button>
                `;

                item.querySelector('.language-item__remove').addEventListener('click', () => {
                    item.remove();
                });

                languagesList.appendChild(item);
            }

            document.getElementById('addLanguageBtn').addEventListener('click', () => addLanguage());

            // Añadir español por defecto
            addLanguage('es', 'native');

            // =====================================================
            // Preguntas personalizadas
            // =====================================================
            const questionsContainer = document.getElementById('customQuestions');
            let questionIdCounter = 0;

            function addQuestion(text = '') {
                const id = questionIdCounter++;
                const item = document.createElement('div');
                item.className = 'language-item';
                item.dataset.id = id;
                item.innerHTML = `
                    <input type="text" class="form-input question-input" placeholder="Escribe la pregunta..." value="${text}">
                    <button class="language-item__remove" title="Eliminar">
                        <i class="fas fa-trash"></i>
                    </button>
                `;

                item.querySelector('.language-item__remove').addEventListener('click', () => {
                    item.remove();
                });

                questionsContainer.appendChild(item);
            }

            document.getElementById('addQuestionBtn').addEventListener('click', () => addQuestion());

            // =====================================================
            // Modalidad (radio buttons styling)
            // =====================================================
            document.querySelectorAll('.interview-type input[type="radio"]').forEach(radio => {
                radio.addEventListener('change', () => {
                    const name = radio.name;
                    document.querySelectorAll(`.interview-type input[name="${name}"]`).forEach(r => {
                        r.closest('.interview-type').classList.remove('interview-type--selected');
                    });
                    radio.closest('.interview-type').classList.add('interview-type--selected');
                });
            });

            // =====================================================
            // Pesos de filtrado
            // =====================================================
            const weightInputs = ['weightExperience', 'weightSkills', 'weightEducation', 'weightLanguages'];
            const weightValues = ['weightExpValue', 'weightSkillsValue', 'weightEducationValue', 'weightLanguagesValue'];

            function updateWeights() {
                let total = 0;
                weightInputs.forEach((id, idx) => {
                    const input = document.getElementById(id);
                    const value = parseInt(input.value) || 0;
                    document.getElementById(weightValues[idx]).textContent = value + '%';
                    total += value;
                });

                const totalEl = document.getElementById('weightTotal');
                totalEl.textContent = total + '%';
                totalEl.style.color = total === 100 ? '#10b981' : '#ef4444';
            }

            weightInputs.forEach(id => {
                document.getElementById(id).addEventListener('input', updateWeights);
            });

            // =====================================================
            // Upload de documentos
            // =====================================================
            const uploadZone = document.getElementById('uploadZone');
            const fileInput = document.getElementById('fileInput');
            const documentsList = document.getElementById('documentsList');

            uploadZone.addEventListener('click', () => fileInput.click());

            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadZone.classList.add('upload-zone--dragover');
            });

            uploadZone.addEventListener('dragleave', () => {
                uploadZone.classList.remove('upload-zone--dragover');
            });

            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.classList.remove('upload-zone--dragover');
                handleFiles(e.dataTransfer.files);
            });

            fileInput.addEventListener('change', () => handleFiles(fileInput.files));

            function handleFiles(files) {
                Array.from(files).forEach(file => {
                    if (file.size > 10 * 1024 * 1024) {
                        alert(`El archivo ${file.name} es demasiado grande (máx 10MB)`);
                        return;
                    }

                    const docItem = document.createElement('div');
                    docItem.className = 'document-item';
                    docItem.innerHTML = `
                        <div class="document-item__icon">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="document-item__info">
                            <span class="document-item__name">${file.name}</span>
                            <span class="document-item__size">${(file.size / 1024).toFixed(1)} KB</span>
                        </div>
                        <button class="document-item__remove">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;

                    docItem.querySelector('.document-item__remove').addEventListener('click', () => {
                        docItem.remove();
                    });

                    documentsList.appendChild(docItem);
                    profileData.documents.push(file);
                });
            }

            // =====================================================
            // Contador de caracteres descripción
            // =====================================================
            const descriptionInput = document.getElementById('jobDescription');
            const descriptionCount = document.getElementById('descriptionCount');

            descriptionInput.addEventListener('input', () => {
                descriptionCount.textContent = descriptionInput.value.length;
            });

            // =====================================================
            // Guardar / Cancelar
            // =====================================================
            function saveProfile() {
                const name = document.getElementById('profileName').value.trim();
                if (!name) {
                    alert('Por favor, introduce el nombre del puesto');
                    switchTab('basic');
                    return;
                }

                // Recopilar todos los datos
                const data = {
                    name: name,
                    department: document.getElementById('departmentSelect').value,
                    location: document.getElementById('locationInput').value,
                    modality: document.querySelector('input[name="modality"]:checked')?.value || 'hybrid',
                    description: document.getElementById('jobDescription').value,
                    salaryMin: parseInt(document.getElementById('salaryMin').value) || null,
                    salaryMax: parseInt(document.getElementById('salaryMax').value) || null,
                    salaryPeriod: document.getElementById('salaryPeriod').value,
                    salaryVisible: document.getElementById('salaryVisible').checked,
                    minExperienceYears: parseInt(document.getElementById('minExperience').value) || 0,
                    requirements: {
                        essential: profileData.essential,
                        desired: profileData.desired,
                        niceToHave: profileData.niceToHave
                    },
                    languages: Array.from(document.querySelectorAll('.language-item')).map(item => ({
                        language: item.querySelector('.lang-select').value,
                        level: item.querySelector('.level-select').value
                    })).filter(l => l.language),
                    filtering: {
                        weights: {
                            experience: parseInt(document.getElementById('weightExperience').value),
                            skills: parseInt(document.getElementById('weightSkills').value),
                            education: parseInt(document.getElementById('weightEducation').value),
                            languages: parseInt(document.getElementById('weightLanguages').value)
                        },
                        maxCandidatesInterview: parseInt(document.getElementById('maxCandidatesInterview').value) || 20,
                        autoRejectBelow: parseInt(document.getElementById('minScore').value) || 40
                    },
                    interview: {
                        type: document.querySelector('input[name="interviewType"]:checked')?.value || 'competency',
                        durationMinutes: parseInt(document.getElementById('interviewDuration').value) || 20,
                        language: document.getElementById('interviewLanguage').value,
                        evaluationAspects: Array.from(document.querySelectorAll('.evaluation-aspect input:checked')).map(cb => cb.id.replace('aspect', '').toLowerCase()),
                        customQuestions: Array.from(document.querySelectorAll('.question-input')).map(i => i.value.trim()).filter(q => q)
                    }
                };

                console.log('Guardando perfil:', data);
                alert('Perfil guardado correctamente (demo - sin backend)');
                window.location.href = '/app/rrhh/profiles/';
            }

            function cancel() {
                if (confirm('¿Estás seguro? Se perderán los cambios no guardados.')) {
                    window.location.href = '/app/rrhh/profiles/';
                }
            }

            document.getElementById('saveBtn').addEventListener('click', saveProfile);
            document.getElementById('saveBtnFinal').addEventListener('click', saveProfile);
            document.getElementById('cancelBtn').addEventListener('click', cancel);
            document.getElementById('cancelBtnFinal').addEventListener('click', cancel);

            // =====================================================
            // Cargar perfil existente (si hay ?id= en URL)
            // =====================================================
            const urlParams = new URLSearchParams(window.location.search);
            const profileId = urlParams.get('id');

            if (profileId) {
                document.getElementById('profileTitle').textContent = 'Editar Perfil de Puesto';
                document.getElementById('breadcrumbTitle').textContent = 'Editar Perfil';
                // TODO: Cargar datos del perfil desde API
            }
        });
    </script>
</body>
</html>
